name: Claude Code Review
on:
    pull_request:
        types: [opened, synchronize]

jobs:
    code-review:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            pull-requests: write
            id-token: write
        steps:
            - uses: actions/checkout@v6
              with:
                  fetch-depth: 1

            - uses: anthropics/claude-code-action@v1
              with:
                  claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
                  # anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
                  prompt: |
                      REPO: ${{ github.repository }}
                      PR NUMBER: ${{ github.event.pull_request.number }}

                      Please review this pull request and provide feedback on:
                      - Code quality and best practices
                      - Potential bugs or issues
                      - Performance considerations
                      - Security concerns
                      - Test coverage

                      Use the repository's CLAUDE.md for guidance on style and conventions. Be constructive and helpful in your feedback.

                      Use `gh pr comment` with your Bash tool to leave your review as a comment on the PR.

                  claude_args: |
                      --model claude-opus-4-5
                      --allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"
