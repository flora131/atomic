# Source Control Type Selection - Implementation Progress

## Session: 2026-02-12

### Completed Tasks

#### Task #1: Add SourceControlType, ScmConfig, and SCM_CONFIG to src/config.ts
- Added `SourceControlType` union type for supported SCM systems ('github' | 'sapling-phabricator')
- Added `ScmConfig` interface with all required fields (name, displayName, cliTool, reviewTool, reviewSystem, detectDir, reviewCommandFile, requiredConfigFiles)
- Added `SCM_CONFIG` constant with configurations for both GitHub and Sapling+Phabricator
- Added `SCM_SPECIFIC_COMMANDS` array containing commands that need SCM-specific variants

#### Task #2: Add SCM helper functions
- Added `getScmKeys()` function to return all SCM type keys
- Added `isValidScm()` type guard function to validate SCM type strings
- Added `getScmConfig()` function to retrieve configuration for a specific SCM type

#### Task #31: Write unit tests for SCM config functions
- Added comprehensive tests in tests/config.test.ts
- Tests cover all SCM_CONFIG fields validation
- Tests cover isValidScm with valid and invalid inputs
- Tests cover getScmConfig for both SCM types
- Tests cover getScmKeys immutability
- Tests cover SCM_SPECIFIC_COMMANDS content
- All 33 tests pass (including 15 new SCM-related tests)

### Files Modified
- src/config.ts - Added SCM types, interfaces, constants, and helper functions
- tests/config.test.ts - Added comprehensive unit tests for SCM functionality

#### Task #3-5: Create src/utils/atomic-config.ts module
- Created AtomicConfig interface with fields: version, agent, scm, lastUpdated
- Implemented readAtomicConfig() to read .atomic.json from project directory
- Implemented saveAtomicConfig() to save/merge config updates
- Implemented getSelectedScm() convenience function
- All functions handle missing files gracefully (return null)
- Config file is formatted with 2-space indentation and trailing newline

#### Task #32: Write unit tests for atomic-config.ts
- Added comprehensive tests in tests/utils/atomic-config.test.ts
- Tests cover all three functions with edge cases
- Tests use temp directories for isolation
- All 14 tests pass

### Files Modified (Session 2 - Config Persistence)
- src/utils/atomic-config.ts - New file with AtomicConfig interface and functions
- tests/utils/atomic-config.test.ts - New file with unit tests

### Next Priority Tasks
1. Create templates/scm/github/ directory structure for all agents
2. Write GitHub commit.md content (adapted from gh-commit.md)
3. Write GitHub create-gh-pr.md content for all agents

### Notes
- Pre-existing type errors exist in the codebase (copilot-client.ts, chat.tsx, various test files) but are unrelated to this feature
- The config.ts changes compile cleanly and all related tests pass
