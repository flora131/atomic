[
  {
    "category": "refactor",
    "description": "Create CommandRegistry class and CommandDefinition interface",
    "steps": [
      "Create src/ui/commands/registry.ts file",
      "Define CommandDefinition interface with name, description, category, execute, aliases, hidden fields",
      "Define CommandContext interface with session, state, addMessage, setStreaming",
      "Define CommandResult interface with success, message, stateUpdate",
      "Implement CommandRegistry class with private commands Map and aliases Map",
      "Implement register() method to add commands and their aliases",
      "Implement get() method to retrieve command by name or alias",
      "Implement search() method with prefix matching and sorting (exact match > category > alphabetical)",
      "Implement all() method to return all visible commands",
      "Export globalRegistry singleton instance",
      "Add unit tests for CommandRegistry in tests/ui/commands/registry.test.ts"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Implement built-in commands (/help, /status, /approve, /reject, /theme, /clear)",
    "steps": [
      "Create src/ui/commands/builtin-commands.ts file",
      "Implement /help command that lists all commands with descriptions",
      "Implement /status command that shows workflow progress (feature iteration, spec status)",
      "Implement /approve command that sets specApproved: true in state",
      "Implement /reject command that sets specApproved: false and stores feedback",
      "Implement /theme command that toggles dark/light ThemeContext",
      "Implement /clear command that resets messages array",
      "Create registerBuiltinCommands() function to register all built-ins with globalRegistry",
      "Add unit tests in tests/ui/commands/builtin-commands.test.ts"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Implement workflow command registration from src/workflows/atomic.ts",
    "steps": [
      "Create src/ui/commands/workflow-commands.ts file",
      "Define WorkflowMetadata interface with name, description, aliases, createWorkflow",
      "Define WORKFLOW_DEFINITIONS array with atomic workflow metadata",
      "Implement workflow command execute function that creates workflow and starts execution",
      "Command execute should add 'Starting workflow...' message and update state",
      "Set workflowActive: true, workflowType, initialPrompt in state",
      "Create registerWorkflowCommands() function to register all workflow commands",
      "Add unit tests in tests/ui/commands/workflow-commands.test.ts"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Implement skill command registration from system-reminder skill list",
    "steps": [
      "Create src/ui/commands/skill-commands.ts file",
      "Define SKILL_DEFINITIONS array with all skills from system-reminder",
      "Include skills: commit, research-codebase, create-spec, create-feature-list, implement-feature, create-gh-pr, explain-code",
      "Include ralph skills: ralph:ralph-loop, ralph:cancel-ralph, ralph:ralph-help",
      "Implement skill command execute function that invokes the skill via session",
      "Create registerSkillCommands() function to register all skills with globalRegistry",
      "Add unit tests in tests/ui/commands/skill-commands.test.ts"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Create commands module index with initialization function",
    "steps": [
      "Create src/ui/commands/index.ts file",
      "Export CommandRegistry, globalRegistry from registry.ts",
      "Export CommandDefinition, CommandContext, CommandResult types",
      "Export registerBuiltinCommands from builtin-commands.ts",
      "Export registerWorkflowCommands from workflow-commands.ts",
      "Export registerSkillCommands from skill-commands.ts",
      "Implement initializeCommands() function that calls all register functions",
      "Add parseSlashCommand() helper to extract command name and args from input",
      "Add unit tests for initializeCommands in tests/ui/commands/index.test.ts"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create Autocomplete component with two-column layout",
    "steps": [
      "Create src/ui/components/autocomplete.tsx file",
      "Define AutocompleteProps interface with input, visible, selectedIndex, onSelect, onIndexChange, maxSuggestions",
      "Implement Autocomplete component using OpenTUI box and text primitives",
      "Render two-column layout: command name | description",
      "Apply highlighting to selected suggestion row",
      "Use theme colors for styling (accent for selected, foreground for normal)",
      "Support maxSuggestions prop (default 8) to limit displayed items",
      "Filter suggestions using CommandRegistry.search() based on input prefix",
      "Add unit tests in tests/ui/components/autocomplete.test.tsx"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Implement keyboard navigation for autocomplete",
    "steps": [
      "Add useKeyboard hook to Autocomplete component",
      "Implement Up arrow to move selection up with wrap to bottom",
      "Implement Down arrow to move selection down with wrap to top",
      "Implement Tab key to complete selected command (call onSelect)",
      "Implement Enter key to execute selected command (call onSelect)",
      "Implement Escape key to hide autocomplete (handled by parent)",
      "Prevent default behavior for navigation keys when autocomplete is visible",
      "Add keyboard navigation tests to tests/ui/components/autocomplete.test.tsx"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Extend WorkflowChatState with autocomplete and workflow execution state",
    "steps": [
      "Modify src/ui/chat.tsx to add new state fields",
      "Add showAutocomplete: boolean to state",
      "Add autocompleteInput: string to state",
      "Add selectedSuggestionIndex: number to state",
      "Add workflowActive: boolean to state",
      "Add workflowType: string | null to state",
      "Add initialPrompt: string | null to state",
      "Add pendingApproval: boolean to state",
      "Add specApproved: boolean to state",
      "Add feedback: string | null to state",
      "Initialize new state fields in ChatApp component"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Integrate autocomplete into ChatApp input handling",
    "steps": [
      "Modify ChatApp in src/ui/chat.tsx to integrate autocomplete",
      "Add handleInputChange callback that detects '/' prefix",
      "Show autocomplete when input starts with '/' and has no space",
      "Update autocompleteInput state with text after '/'",
      "Reset selectedSuggestionIndex to 0 on input change",
      "Hide autocomplete when input doesn't start with '/' or has space",
      "Render Autocomplete component conditionally based on showAutocomplete",
      "Pass selectedIndex and onIndexChange to Autocomplete",
      "Add integration tests for autocomplete triggering"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Implement command completion and execution in ChatApp",
    "steps": [
      "Implement handleAutocompleteSelect callback in ChatApp",
      "On Tab completion: replace input with '/' + selected command name + space",
      "On Enter execution: parse input to extract command name and args",
      "Look up command in globalRegistry.get()",
      "Create CommandContext with session, state, addMessage, setStreaming",
      "Call command.execute(args, context) and await result",
      "Apply result.stateUpdate to ChatApp state if present",
      "Display result.message in chat if present",
      "Handle command not found error gracefully",
      "Add tests for command execution flow"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create UserQuestionDialog component for HITL interactions",
    "steps": [
      "Create src/ui/components/user-question-dialog.tsx file",
      "Define UserQuestionDialogProps with question object and onAnswer callback",
      "Implement dialog overlay using absolute positioning",
      "Display question header and question text",
      "Render options list with keyboard selection (up/down)",
      "Support multiSelect mode with checkbox indicators",
      "Implement space key for toggling multi-select options",
      "Implement Enter key to confirm selection and call onAnswer",
      "Style with theme colors and double border",
      "Add unit tests in tests/ui/components/user-question-dialog.test.tsx"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create WorkflowStatusBar component for progress display",
    "steps": [
      "Create src/ui/components/workflow-status-bar.tsx file",
      "Define WorkflowStatusBarProps with workflowActive, workflowType, currentNode, iteration, featureProgress",
      "Render status bar only when workflowActive is true",
      "Display workflow type with accent color and icon",
      "Display current node name if present",
      "Display iteration count",
      "Display feature progress as completed/total if present",
      "Use horizontal flexbox layout with gap between elements",
      "Add single border with theme border color",
      "Add unit tests in tests/ui/components/workflow-status-bar.test.tsx"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create useStreamingState hook for real-time updates",
    "steps": [
      "Create src/ui/hooks/use-streaming-state.ts file",
      "Define StreamingState interface with isStreaming, streamingMessageId, toolExecutions, pendingQuestions",
      "Define ToolExecutionState interface with toolName, status, input, output, error, timestamps",
      "Implement useStreamingState hook with useState",
      "Implement handleChunk callback for streaming message updates",
      "Implement handleToolStart callback for tool execution start",
      "Implement handleToolComplete callback for tool completion",
      "Implement handleToolError callback for tool errors",
      "Return state and all handler callbacks",
      "Add unit tests in tests/ui/hooks/use-streaming-state.test.ts"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Create hooks module index with exports",
    "steps": [
      "Create src/ui/hooks/index.ts file",
      "Export useStreamingState hook and types",
      "Export StreamingState type",
      "Export ToolExecutionState type",
      "Update src/ui/index.ts to re-export hooks module"
    ],
    "passes": false
  },
  {
    "category": "refactor",
    "description": "Create ToolResultRegistry for tool-specific rendering",
    "steps": [
      "Create src/ui/tools/registry.ts file",
      "Define ToolRenderer interface with icon, title function, render function",
      "Define ToolRenderProps interface with input, output, syntaxStyle",
      "Create TOOL_RENDERERS Record mapping tool names to renderers",
      "Implement Read tool renderer with file path title and code content",
      "Implement Edit tool renderer with diff display",
      "Implement Bash tool renderer with command and output display",
      "Implement Write tool renderer with created/updated status",
      "Export getToolRenderer(toolName) helper function",
      "Add unit tests in tests/ui/tools/registry.test.ts"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Create ToolResult component for rendering tool outputs",
    "steps": [
      "Create src/ui/components/tool-result.tsx file",
      "Define ToolResultProps with toolName, input, output, status",
      "Use ToolResultRegistry to get appropriate renderer",
      "Render tool icon and title from renderer",
      "Render tool output using renderer's render function",
      "Handle unknown tools with generic fallback display",
      "Show loading indicator when status is 'running'",
      "Show error styling when status is 'error'",
      "Add collapsible behavior for large outputs",
      "Add unit tests in tests/ui/components/tool-result.test.tsx"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Create tools module index with exports",
    "steps": [
      "Create src/ui/tools/index.ts file",
      "Export ToolRenderer, ToolRenderProps types from registry.ts",
      "Export TOOL_RENDERERS, getToolRenderer from registry.ts",
      "Update src/ui/index.ts to re-export tools module"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Update src/ui/index.ts with all new exports",
    "steps": [
      "Export all types and components from commands module",
      "Export Autocomplete component from components",
      "Export UserQuestionDialog component from components",
      "Export WorkflowStatusBar component from components",
      "Export ToolResult component from components",
      "Export hooks module (useStreamingState)",
      "Export tools module (ToolResultRegistry)",
      "Export initializeCommands function",
      "Export parseSlashCommand helper"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Update ChatApp to render WorkflowStatusBar and ToolResults",
    "steps": [
      "Import WorkflowStatusBar component in chat.tsx",
      "Import ToolResult component in chat.tsx",
      "Render WorkflowStatusBar between header and chat history",
      "Pass workflow state to WorkflowStatusBar (workflowActive, workflowType, etc.)",
      "Update MessageBubble to detect and render tool results",
      "Parse tool call/result patterns from assistant messages",
      "Render ToolResult components for each tool execution",
      "Add integration tests for workflow status display"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Connect ChatApp to workflow execution with streaming",
    "steps": [
      "Import useStreamingState hook in chat.tsx",
      "Initialize streaming state with useStreamingState",
      "Connect SDK session events to streaming state handlers",
      "Display tool execution progress in real-time",
      "Handle human_input_required signal by showing UserQuestionDialog",
      "Pass user responses back to workflow via state update",
      "Update workflow state on execution progress",
      "Add integration tests for workflow execution flow"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Implement /approve and /reject commands with workflow state management",
    "steps": [
      "Update /approve command to work with workflow execution context",
      "Update /reject command to work with workflow execution context",
      "Resume paused workflow execution on approval",
      "Loop back to spec creation on rejection with feedback",
      "Store rejection feedback in workflow state",
      "Display appropriate confirmation messages",
      "Add integration tests for approval/rejection flow"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Implement /status command with comprehensive workflow info",
    "steps": [
      "Enhance /status command to show detailed workflow status",
      "Display current workflow type and phase",
      "Display current iteration number and max iterations",
      "Display spec approval status (pending/approved/rejected)",
      "Display feature list progress (completed/total, current feature)",
      "Display context window usage percentage",
      "Format output with theme colors and clear sections",
      "Add tests for status output formatting"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Integrate autocomplete system with ChatApp initialization",
    "steps": [
      "Call initializeCommands() in startChatUI before rendering",
      "Ensure globalRegistry is populated before ChatApp renders",
      "Add debug logging for registered command count",
      "Handle registration errors gracefully",
      "Add integration test for full autocomplete initialization"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Add components module index with exports",
    "steps": [
      "Create src/ui/components/index.ts file",
      "Export Autocomplete component and AutocompleteProps type",
      "Export UserQuestionDialog component and UserQuestionDialogProps type",
      "Export WorkflowStatusBar component and WorkflowStatusBarProps type",
      "Export ToolResult component and ToolResultProps type"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Create unit tests for CommandRegistry",
    "steps": [
      "Create tests/ui/commands/registry.test.ts file",
      "Test register() adds command to registry",
      "Test get() retrieves command by name",
      "Test get() retrieves command by alias",
      "Test get() returns undefined for unknown command",
      "Test search() returns commands matching prefix",
      "Test search() excludes hidden commands",
      "Test search() sorts by category then alphabetically",
      "Test all() returns all visible commands"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Create unit tests for built-in commands",
    "steps": [
      "Create tests/ui/commands/builtin-commands.test.ts file",
      "Test /help lists all commands",
      "Test /status shows workflow state",
      "Test /approve sets specApproved to true",
      "Test /reject sets specApproved to false and stores feedback",
      "Test /theme toggles dark/light",
      "Test /clear resets messages array"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Create integration tests for Autocomplete component",
    "steps": [
      "Create tests/ui/components/autocomplete.test.tsx file",
      "Test renders suggestions matching input prefix",
      "Test highlights selected suggestion",
      "Test keyboard up/down navigates suggestions",
      "Test Tab completes selected command",
      "Test Enter executes selected command",
      "Test Escape hides autocomplete"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Create end-to-end tests for ChatApp command integration",
    "steps": [
      "Create tests/ui/chat-commands.test.tsx file",
      "Test typing '/' shows autocomplete",
      "Test typing '/at' filters to 'atomic' workflow",
      "Test executing '/atomic Build feature' starts workflow",
      "Test executing '/help' shows help message",
      "Test executing '/status' shows workflow status",
      "Test executing '/approve' approves spec"
    ],
    "passes": false
  }
]
