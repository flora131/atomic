[
  {
    "category": "refactor",
    "description": "Create ralph-loop.ts TypeScript script to replace setup-ralph-loop.sh",
    "steps": [
      "Create .github/scripts/ralph-loop.ts with shebang and imports",
      "Implement CLI argument parsing for --max-iterations, --completion-promise, --feature-list, and --help options",
      "Add validation logic for feature list existence when using default prompt",
      "Implement YAML frontmatter markdown state file creation (.github/ralph-loop.local.md)",
      "Write continue flag file with prompt content",
      "Add setup summary output",
      "Test CLI invocation with various argument combinations",
      "Verify state file format matches YAML frontmatter specification"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Create start-ralph-session.ts TypeScript script to replace start-ralph-session.sh",
    "steps": [
      "Create .github/scripts/start-ralph-session.ts with shebang and imports",
      "Implement stdin JSON parsing following stop-hook.ts pattern (lines 413-429)",
      "Ensure .github/logs/ directory exists using mkdirSync",
      "Append session start entry to ralph-sessions.jsonl in JSONL format",
      "Implement Ralph loop active check by reading .github/ralph-loop.local.md",
      "Add iteration status output to stderr when loop is active",
      "Increment iteration and update state file for resume/startup source types",
      "Follow YAML frontmatter parsing pattern from .opencode/plugin/ralph.ts:119-168",
      "Test hook invocation with mock JSON input"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Create cancel-ralph.ts TypeScript script to replace cancel-ralph.sh",
    "steps": [
      "Create .github/scripts/cancel-ralph.ts with shebang and imports",
      "Check if state file exists and handle missing state gracefully",
      "Read and parse YAML frontmatter state file",
      "Create .github/logs/ directory if needed",
      "Archive state to .github/logs/ralph-loop-cancelled-{timestamp}.md",
      "Delete state file (.github/ralph-loop.local.md)",
      "Delete continue flag file (.github/ralph-continue.flag)",
      "Kill orphaned copilot and sleep.*copilot processes using Bun.$ with pkill -f",
      "Print cancellation summary to stdout",
      "Test full cancellation workflow"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Update stop-hook.ts to read new YAML frontmatter state file format",
    "steps": [
      "Locate current JSON state file reading logic in .github/hooks/stop-hook.ts",
      "Replace JSON parsing with YAML frontmatter parsing using regex pattern from .opencode/plugin/ralph.ts",
      "Update state file path from .local.json to .local.md",
      "Ensure backwards compatibility is not needed (clean migration)",
      "Test stop hook with new state file format",
      "Verify session logging still works correctly"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Update hooks.json to reference new TypeScript sessionStart script",
    "steps": [
      "Read current .github/hooks/hooks.json configuration",
      "Update sessionStart hook bash command from start-ralph-session.sh to bun run ./.github/scripts/start-ralph-session.ts",
      "Update sessionStart hook powershell command to bun run ./.github/scripts/start-ralph-session.ts",
      "Verify sessionEnd hook already uses TypeScript (no change needed)",
      "Test hooks.json syntax validity"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Delete obsolete shell scripts after successful TypeScript conversion",
    "steps": [
      "Verify all TypeScript scripts are working correctly",
      "Run full Ralph loop lifecycle test (setup -> start -> prompt -> end -> cancel)",
      "Delete .github/scripts/cancel-ralph.sh",
      "Delete .github/scripts/setup-ralph-loop.sh",
      "Delete .github/scripts/start-ralph-session.sh",
      "Delete .github/scripts/log-ralph-prompt.sh if it exists",
      "Delete any old .local.json state files",
      "Verify no references to deleted files remain in codebase"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Implement unit tests for YAML frontmatter parsing and writing",
    "steps": [
      "Create test file for YAML frontmatter utilities",
      "Test parsing of valid YAML frontmatter with all fields",
      "Test parsing with missing optional fields",
      "Test parsing of empty or malformed frontmatter",
      "Test writing state with various field combinations",
      "Test round-trip parsing and writing consistency",
      "Test edge cases: special characters, multiline prompts, null values"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Implement unit tests for CLI argument parsing in ralph-loop.ts",
    "steps": [
      "Create test file for CLI argument parsing",
      "Test default values when no arguments provided",
      "Test --max-iterations with valid integer",
      "Test --completion-promise with quoted string",
      "Test --feature-list with custom path",
      "Test -h and --help flags",
      "Test invalid argument handling and error messages",
      "Test positional arguments for prompt"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Implement integration tests for full Ralph loop lifecycle",
    "steps": [
      "Create integration test file for Ralph loop workflow",
      "Test loop setup with ralph-loop.ts creates correct state files",
      "Test session start hook increments iteration correctly",
      "Test stop hook updates state file properly",
      "Test cancel operation archives and cleans up files",
      "Test max iterations causes automatic loop termination",
      "Test completion promise detection ends loop",
      "Verify cross-platform compatibility with Bun runtime"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Update documentation to reflect TypeScript conversion",
    "steps": [
      "Update README.md with new TypeScript script invocation commands",
      "Document new YAML frontmatter state file format",
      "Update any Ralph loop usage documentation",
      "Remove references to jq dependency",
      "Document Bun runtime requirement",
      "Add migration notes for users with existing JSON state files"
    ],
    "passes": false
  }
]
