[
  {
    "category": "functional",
    "description": "Add rm() call to remove data directory before extractConfig() in the TypeScript update command",
    "steps": [
      "Open src/commands/update.ts",
      "Locate lines 245-249 in updateCommand() where extractConfig is called",
      "Add 'await rm(dataDir, { recursive: true, force: true })' after getting dataDir and before calling extractConfig()",
      "Verify the rm import already exists on line 10 from 'fs/promises'",
      "Confirm extractConfig() already calls mkdir(dataDir, { recursive: true }) to recreate the directory"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Add rm -rf and mkdir -p to install.sh before tar extraction to ensure clean data directory",
    "steps": [
      "Open install.sh",
      "Locate lines 201-203 where tar extraction occurs",
      "Add 'rm -rf \"$DATA_DIR\"' before the tar command",
      "Add 'mkdir -p \"$DATA_DIR\"' after the rm and before the tar command",
      "Update the comment to indicate clean install behavior"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Add Remove-Item and New-Item to install.ps1 before Expand-Archive to ensure clean data directory",
    "steps": [
      "Open install.ps1",
      "Locate lines 139-141 where Expand-Archive is called",
      "Add 'if (Test-Path $DataDir) { Remove-Item -Recurse -Force $DataDir }' before Expand-Archive",
      "Add '$null = New-Item -ItemType Directory -Force -Path $DataDir' after Remove-Item and before Expand-Archive",
      "Update the comment to indicate clean install behavior"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Verify no stale artifacts remain after update or re-install across all three code paths",
    "steps": [
      "Build a binary with an older config set",
      "Add a stale file to the data directory manually",
      "Run 'atomic update'",
      "Verify the stale file no longer exists in the data directory",
      "Repeat verification for install.sh and install.ps1 re-install paths"
    ],
    "passes": false
  }
]
