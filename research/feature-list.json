[
  {
    "category": "functional",
    "description": "Reorder command routing to check positional commands before --agent flag",
    "steps": [
      "Open src/index.ts and locate entry point (lines 54-106)",
      "Identify current routing order: --version, --help, --agent, positionals",
      "Reorder to: --version, --help, positionals, --agent (only when no positional)",
      "Ensure 'init' command is checked before standalone --agent handling",
      "Verify backward compatibility with existing 'atomic' and 'atomic init' commands"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Add preSelectedAgent option to InitOptions interface",
    "steps": [
      "Open src/commands/init.ts and locate InitOptions interface (lines 24-26)",
      "Add preSelectedAgent?: AgentKey property to InitOptions",
      "Import AgentKey type if not already imported",
      "Verify TypeScript compilation succeeds"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Implement conditional agent selection skip in init command",
    "steps": [
      "Open src/commands/init.ts and locate agent selection logic (lines 65-81)",
      "Add conditional check for options.preSelectedAgent",
      "If preSelectedAgent is provided, validate it with isValidAgent()",
      "If invalid, call cancel() and exit with code 1",
      "If valid, use preSelectedAgent directly and log info message",
      "Skip the interactive select() prompt when preSelectedAgent is set",
      "Preserve existing interactive flow when preSelectedAgent is not set"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Pass --agent flag to init command when 'init' subcommand is used",
    "steps": [
      "Open src/index.ts and locate positional command handling",
      "In the 'init' case, pass values.agent as preSelectedAgent to initCommand()",
      "Cast values.agent to AgentKey | undefined",
      "Ensure showBanner option is still passed correctly"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Add config folder existence check in runAgentCommand",
    "steps": [
      "Open src/commands/run-agent.ts and locate runAgentCommand function (lines 24-57)",
      "Import join from 'path'",
      "Import pathExists from '../utils/copy'",
      "Import initCommand from './init'",
      "After agent key validation, construct config folder path using agent.folder",
      "Check if config folder exists using pathExists()",
      "If folder does not exist, call initCommand with preSelectedAgent and showBanner: false",
      "Continue with existing agent spawn logic after init completes"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Update help text to document new behaviors",
    "steps": [
      "Open src/index.ts and locate help text output",
      "Add 'atomic init --agent <name>' to usage examples",
      "Add 'atomic init -a <name>' short form to examples",
      "Document that 'atomic --agent <name>' now auto-initializes if needed",
      "Show both --agent and -a forms in options section",
      "Add examples section showing common use cases"
    ],
    "passes": true
  },
  {
    "category": "refactor",
    "description": "Create isValidAgent type guard utility if not exists",
    "steps": [
      "Check if isValidAgent() already exists in src/config.ts or related file",
      "If not, create type guard function: (key: string) => key is AgentKey",
      "Implement by checking if key exists in AGENT_CONFIG keys",
      "Export the function for use in other modules"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Unit tests for initCommand with preSelectedAgent",
    "steps": [
      "Create or update tests/init.test.ts",
      "Add test: initCommand uses preSelectedAgent when provided",
      "Mock @clack/prompts to verify select() is NOT called",
      "Add test: initCommand rejects invalid preSelectedAgent",
      "Verify invalid agent causes exit with error"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Unit tests for runAgentCommand auto-init behavior",
    "steps": [
      "Create or update tests/run-agent.test.ts",
      "Add test: runAgentCommand calls initCommand when config folder missing",
      "Mock pathExists to return false",
      "Mock initCommand and verify it's called with correct args",
      "Add test: runAgentCommand skips init when config folder exists",
      "Mock pathExists to return true",
      "Verify initCommand is NOT called"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Integration tests for argument parsing with init subcommand",
    "steps": [
      "Create or update tests/routing.test.ts",
      "Add test: parses 'init --agent claude-code' correctly",
      "Add test: parses 'init -a claude-code' correctly (short form)",
      "Add test: parses '--agent claude-code' without init",
      "Add test: parses '-a claude-code' without init (short form)",
      "Verify positionals and values are parsed as expected"
    ],
    "passes": true
  }
]
