[
  {
    "category": "functional",
    "description": "Phase 1.1: Create src/graph/types.ts with BaseState interface",
    "steps": [
      "Create src/graph/types.ts file",
      "Define BaseState interface with executionId: string, lastUpdated: Date, outputs: Record<string, unknown>",
      "Add JSDoc documentation explaining BaseState is the foundation for all workflow states",
      "Export the interface",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.2: Add ExecutionContext interface to graph types",
    "steps": [
      "In src/graph/types.ts, add ExecutionContext<TState extends BaseState> interface",
      "Include fields: state: Readonly<TState>, config: GraphConfig, errors: ExecutionError[], abortSignal?: AbortSignal, contextWindowUsage?: number",
      "Add JSDoc documentation explaining context passed to all nodes",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.3: Add NodeResult interface to graph types",
    "steps": [
      "In src/graph/types.ts, add NodeResult<TState extends BaseState> interface",
      "Include fields: stateUpdate?: Partial<TState>, goto?: NodeId | NodeId[], signals?: Signal[]",
      "Add JSDoc documentation explaining result returned by node execution",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.4: Add NodeType enum and NodeDefinition interface",
    "steps": [
      "In src/graph/types.ts, add NodeId type as string alias",
      "Add NodeType union type: 'agent' | 'tool' | 'decision' | 'wait' | 'subgraph' | 'parallel'",
      "Add NodeDefinition<TState> interface with id: NodeId, type: NodeType, execute: (ctx: ExecutionContext<TState>) => Promise<NodeResult<TState>>, retry?: RetryConfig",
      "Add RetryConfig interface with maxAttempts, backoffMs, backoffMultiplier?, retryOn?",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.5: Add GraphConfig and Signal types",
    "steps": [
      "In src/graph/types.ts, add GraphConfig interface with checkpointer?, maxConcurrency?, timeout?, onProgress?",
      "Add Signal union type with: context_window_warning, checkpoint, human_input_required, debug_report_generated",
      "Add ExecutionError interface with nodeId, error, timestamp, attempt",
      "Add DebugReport interface with errorSummary, stackTrace, relevantFiles, suggestedFixes",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.6: Create src/graph/annotation.ts with Annotation type",
    "steps": [
      "Create src/graph/annotation.ts file",
      "Define Annotation<T> interface with default: T, reducer?: (current: T, update: T) => T",
      "Create annotation<T>(config: Annotation<T>) factory function",
      "Add AnnotationRoot<T> type for combining multiple annotations",
      "Run pnpm typecheck to verify"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Phase 1.7: Add Reducers object with common reducer functions",
    "steps": [
      "In src/graph/annotation.ts, add Reducers object",
      "Implement replace<T> reducer (returns new value)",
      "Implement concat<T> reducer for arrays (concatenates)",
      "Implement merge<T extends object> reducer for objects (shallow merge)",
      "Implement mergeById<T extends { id: string }> reducer for arrays with unique IDs",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 1.8: Create AtomicStateAnnotation example",
    "steps": [
      "In src/graph/annotation.ts, create AtomicStateAnnotation object",
      "Include: executionId, lastUpdated, outputs, researchDoc, specDoc, specApproved, featureList, currentFeature, allFeaturesPassing, debugReports, prUrl, contextWindowUsage, iteration",
      "Use appropriate reducers (mergeById for featureList, concat for debugReports)",
      "Export AtomicWorkflowState type from AnnotationRoot",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 1.9: Create src/graph/checkpointer.ts with Checkpointer interface",
    "steps": [
      "Create src/graph/checkpointer.ts file",
      "Define Checkpointer<TState extends BaseState> interface",
      "Add methods: save(state), load(executionId), list(), delete(executionId)",
      "Add JSDoc documentation for each method",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 1.10: Implement MemorySaver checkpointer",
    "steps": [
      "In src/graph/checkpointer.ts, implement MemorySaver<TState> class",
      "Use Map<string, TState> for in-memory storage",
      "Implement save() using structuredClone for deep copy",
      "Implement load() returning cloned state or undefined",
      "Implement list() returning array of execution IDs",
      "Implement delete() removing from map",
      "Add unit tests for MemorySaver",
      "Run pnpm test to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.1: Create src/graph/builder.ts with GraphBuilder class skeleton",
    "steps": [
      "Create src/graph/builder.ts file",
      "Define GraphBuilder<TState extends BaseState> class",
      "Add private fields: nodes (Map), edges (Array), startNode, endNodes (Set), currentNode",
      "Add constructor",
      "Export graph<TState>() factory function",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.2: Implement start() and then() methods",
    "steps": [
      "In GraphBuilder, implement start(nodeId: NodeId): this",
      "Set startNode and currentNode to nodeId",
      "Implement then(node: NodeDefinition<TState>): this",
      "Add node to nodes map, add edge from currentNode if exists",
      "Update currentNode to new node's id",
      "Return this for chaining",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.3: Implement end() method",
    "steps": [
      "In GraphBuilder, implement end(...nodeIds: NodeId[]): this",
      "Add each nodeId to endNodes set",
      "Return this for chaining",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.4: Implement if(), else(), endif() conditional methods",
    "steps": [
      "In GraphBuilder, add conditionalStack array for tracking nested conditionals",
      "Implement if(condition: (ctx) => boolean): this",
      "Push decision context to stack",
      "Implement else(): this to set alternative branch",
      "Implement endif(): this to pop from stack and finalize conditional edges",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.5: Implement loop() method",
    "steps": [
      "In GraphBuilder, define LoopConfig<TState> interface with until: (ctx) => boolean, maxIterations?",
      "Implement loop(node, config): this",
      "Create loop node wrapper that executes until condition is true or maxIterations reached",
      "Handle signals that should break the loop (e.g., human_input_required)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.6: Implement parallel() method",
    "steps": [
      "In GraphBuilder, implement parallel(nodes, config?): this",
      "Create parallel node that executes branches concurrently",
      "Support merge strategies: 'all', 'first', 'any'",
      "Support custom merge function for combining results",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.7: Implement wait() method for human-in-the-loop",
    "steps": [
      "In GraphBuilder, implement wait(prompt, config?): this",
      "Create wait node that emits human_input_required signal",
      "Support optional autoApprove with timeout",
      "Support inputMapper for processing human response",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.8: Implement catch() error handler method",
    "steps": [
      "In GraphBuilder, implement catch(handler): this",
      "Wrap previous node's execute function with try-catch",
      "Call handler on error, which returns NodeResult for recovery",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.9: Implement compile() method",
    "steps": [
      "In GraphBuilder, implement compile(config?): CompiledGraph<TState>",
      "Validate startNode exists",
      "Create and return new CompiledGraph instance with nodes, edges, startNode, endNodes, config",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 2.10: Add unit tests for GraphBuilder",
    "steps": [
      "Create tests/graph/builder.test.ts",
      "Test: builds linear graph with start().then().then().compile()",
      "Test: handles conditional with if().then().else().then().endif()",
      "Test: loop exits on condition",
      "Test: parallel executes branches concurrently",
      "Test: wait emits human_input_required signal",
      "Test: catch handles errors gracefully",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.1: Create src/graph/compiled.ts with CompiledGraph class skeleton",
    "steps": [
      "Create src/graph/compiled.ts file",
      "Define CompiledGraph<TState extends BaseState> class",
      "Add constructor taking nodes, edges, startNode, endNodes, config",
      "Add execute(initialState) method signature",
      "Add stream(initialState) method signature returning AsyncGenerator<TState>",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.2: Implement initializeState() private method",
    "steps": [
      "In CompiledGraph, implement private initializeState(partial: Partial<TState>): TState",
      "Generate executionId using crypto.randomUUID()",
      "Set lastUpdated to new Date()",
      "Initialize outputs to empty object",
      "Merge with partial state",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.3: Implement mergeState() private method",
    "steps": [
      "In CompiledGraph, implement private mergeState(current: TState, update: Partial<TState>): TState",
      "Use annotation reducers if available",
      "Default to shallow merge for simple properties",
      "Update lastUpdated timestamp",
      "Return new state (immutable update)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.4: Implement executeWithRetry() private method",
    "steps": [
      "In CompiledGraph, implement private executeWithRetry(node, ctx): Promise<NodeResult<TState>>",
      "Get retry config from node or use default (maxAttempts: 1)",
      "Loop up to maxAttempts, catching errors",
      "Check retryOn condition if provided",
      "Apply exponential backoff between attempts",
      "Throw last error if all attempts fail",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.5: Implement stream() execution method",
    "steps": [
      "In CompiledGraph, implement async *stream(initialState): AsyncGenerator<TState>",
      "Initialize state with initializeState()",
      "Use BFS traversal with queue starting from startNode",
      "Track visited nodes to prevent infinite loops (except loop nodes)",
      "For each node: build context, executeWithRetry, mergeState, checkpoint, yield state",
      "Handle signals (human_input_required pauses execution)",
      "Follow edges or goto from result",
      "Stop at end nodes or when queue empty",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.6: Implement execute() method",
    "steps": [
      "In CompiledGraph, implement async execute(initialState): Promise<TState>",
      "Call stream() and iterate to completion",
      "Return final state",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.7: Add checkpointing to execution",
    "steps": [
      "In stream() method, after state update check if checkpointer exists",
      "Call checkpointer.save(state) after each successful node execution",
      "Add getCheckpointedState() method to retrieve last checkpoint",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 3.8: Add unit tests for CompiledGraph execution",
    "steps": [
      "Create tests/graph/compiled.test.ts",
      "Test: executes linear graph in correct order",
      "Test: streaming yields state after each node",
      "Test: retry with exponential backoff",
      "Test: checkpoints saved after each node",
      "Test: human_input_required signal pauses execution",
      "Test: handles errors and populates errors array",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.1: Create src/sdk/types.ts with CodingAgentSession interface",
    "steps": [
      "Create src/sdk/types.ts file",
      "Define CodingAgentSession interface with: id (readonly string), send(message), stream() (AsyncGenerator<unknown>), compact()?, close(), native (readonly unknown)",
      "Add JSDoc documenting thin adapter pattern",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.2: Add CodingAgentClient and CodingAgentSessionConfig interfaces",
    "steps": [
      "In src/sdk/types.ts, define CodingAgentClient<TSession> interface",
      "Add methods: createSession(config), resumeSession(sessionId), events(), start(), stop()",
      "Define CodingAgentSessionConfig interface with model, sessionId?, systemPrompt?, permissionMode?, maxTurns?, nativeOptions?",
      "Add JSDoc explaining SDK-specific options passed through nativeOptions",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.3: Create src/sdk/claude-client.ts ClaudeAgentClient class",
    "steps": [
      "Create src/sdk/claude-client.ts file",
      "Import from @anthropic-ai/claude-agent-sdk (unstable_v2_createSession, unstable_v2_resumeSession, SDKMessage)",
      "Implement ClaudeAgentClient class implementing CodingAgentClient<ClaudeSession>",
      "Add sessions Map for tracking",
      "Implement createSession() using V2 SDK directly",
      "Implement resumeSession()",
      "Implement start(), stop() lifecycle methods",
      "Add JSDoc documenting thin adapter pattern",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.4: Implement ClaudeSession class",
    "steps": [
      "In src/sdk/claude-client.ts, implement ClaudeSession class",
      "Constructor takes id and native V2 session",
      "send() delegates to session.send()",
      "stream() yields native SDKMessage (no transformation)",
      "compact() is no-op (V2 SDK handles auto-compaction)",
      "close() delegates to session.close()",
      "native getter returns underlying session",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.5: Create src/sdk/opencode-client.ts OpenCodeClient class",
    "steps": [
      "Create src/sdk/opencode-client.ts file",
      "Import createOpencodeClient from @opencode-ai/sdk/v2/client",
      "Implement OpenCodeClient class implementing CodingAgentClient<OpenCodeSession>",
      "Constructor creates SDK client with baseUrl and directory",
      "Implement createSession() using client.session.create()",
      "Implement resumeSession() using client.session.get()",
      "Implement events() yielding from client.event.subscribe().stream",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.6: Implement OpenCodeSession class",
    "steps": [
      "In src/sdk/opencode-client.ts, implement OpenCodeSession class",
      "Constructor takes id and client reference",
      "send() uses client.session.prompt()",
      "stream() filters event.subscribe() for this session, yields native events",
      "compact() uses client.session.summarize() (SDK's built-in)",
      "close() uses client.session.delete()",
      "native getter returns client",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.7: Create src/sdk/copilot-client.ts CopilotClient class",
    "steps": [
      "Create src/sdk/copilot-client.ts file",
      "Import CopilotClient as GHCopilotClient from @github/copilot-sdk",
      "Implement CopilotClient class implementing CodingAgentClient<CopilotSession>",
      "Constructor supports stdio, port, or cliUrl configuration",
      "Implement createSession() using client.createSession()",
      "Implement resumeSession() using client.resumeSession()",
      "Implement events() converting callback-based events to async generator",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.8: Implement CopilotSession class",
    "steps": [
      "In src/sdk/copilot-client.ts, implement CopilotSession class",
      "Constructor takes id and native session",
      "send() uses session.send({ prompt })",
      "stream() converts session.on() callbacks to async generator",
      "compact() sends '/compact' command (SDK's built-in)",
      "close() uses session.destroy()",
      "native getter returns session",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.9: Create src/sdk/event-bridge.ts EventBridge class",
    "steps": [
      "Create src/sdk/event-bridge.ts file",
      "Define NativeEvent interface with source ('claude' | 'copilot' | 'opencode') and event (unknown)",
      "Implement EventBridge class with listeners Set",
      "Implement subscribe(handler) returning unsubscribe function",
      "Implement connect(client, source) that forwards native events with source tag",
      "Add JSDoc explaining passthrough pattern (no event mapping)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 4.10: Add unit tests for SDK clients",
    "steps": [
      "Create tests/sdk/claude-client.test.ts with mocked SDK",
      "Test: creates session and returns ClaudeSession",
      "Test: stream() yields native SDKMessage",
      "Create tests/sdk/opencode-client.test.ts with mocked SDK",
      "Test: creates session with proper config",
      "Test: compact() calls session.summarize()",
      "Create tests/sdk/copilot-client.test.ts with mocked SDK",
      "Test: events() converts callbacks to async generator",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.1: Install OpenTUI dependencies",
    "steps": [
      "Run: pnpm add @opentui/core @opentui/react",
      "Verify packages installed in package.json",
      "Run pnpm typecheck to ensure types are available"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.2: Create src/ui/chat.tsx ChatApp component structure",
    "steps": [
      "Create src/ui/chat.tsx file",
      "Import from @opentui/react (render, useKeyboard, useTerminalDimensions)",
      "Import from @opentui/core (createCliRenderer)",
      "Define ChatMessage interface with id, role, content, timestamp, streaming?",
      "Define ChatAppProps interface with onSendMessage, onStreamMessage, onExit",
      "Create ChatApp functional component skeleton",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.3: Implement ChatApp state and hooks",
    "steps": [
      "In ChatApp, add messages state with useState<ChatMessage[]>",
      "Add isStreaming state",
      "Use useTerminalDimensions() for width/height",
      "Use useKeyboard() to handle ESC and Ctrl+C for exit",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.4: Implement handleSubmit callback",
    "steps": [
      "In ChatApp, implement handleSubmit with useCallback",
      "Check for empty input or streaming state",
      "Add user message to messages state",
      "Create placeholder assistant message with streaming: true",
      "Call onSendMessage and stream response",
      "Update assistant message content as chunks arrive",
      "Set streaming: false when complete",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.5: Implement ChatApp JSX layout",
    "steps": [
      "In ChatApp, implement return JSX with OpenTUI components",
      "Add header box with title and help text",
      "Add scrollbox with stickyScroll and viewportCulling for message history",
      "Map messages to MessageBubble components",
      "Add input box with textarea or input component",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.6: Create MessageBubble component",
    "steps": [
      "In src/ui/chat.tsx, create MessageBubble component",
      "Accept message prop of type ChatMessage",
      "Style differently for user vs assistant messages",
      "Show 'typing...' indicator when streaming",
      "Render content with markdown component (streaming support)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.7: Create src/ui/code-block.tsx CodeBlock component",
    "steps": [
      "Create src/ui/code-block.tsx file",
      "Define CodeBlockProps with content, language, streaming?",
      "Implement CodeBlock using OpenTUI code component",
      "Set syntaxStyle to 'monokai'",
      "Support streaming prop",
      "Implement extractCodeBlocks() helper for parsing markdown",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.8: Create src/ui/theme.ts with Theme system",
    "steps": [
      "Create src/ui/theme.ts file",
      "Define Theme interface with name and colors object",
      "Include colors: background, foreground, accent, border, userMessage, assistantMessage, error, success, warning",
      "Create darkTheme constant",
      "Create lightTheme constant",
      "Create ThemeContext and useTheme hook",
      "Create ThemeProvider component",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.9: Create src/ui/index.ts with startChatUI function",
    "steps": [
      "Create src/ui/index.ts file",
      "Import render from @opentui/react, createCliRenderer from @opentui/core",
      "Import ChatApp from ./chat",
      "Implement startChatUI(client, sessionConfig) async function",
      "Create renderer, session variables",
      "Implement handleSendMessage, handleStreamMessage, handleExit",
      "IMPORTANT: Call root.unmount() BEFORE renderer.destroy() to avoid Yoga crash",
      "Handle process signals (SIGINT, SIGTERM)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Phase 5.10: Add unit tests for UI components",
    "steps": [
      "Create tests/ui/chat.test.tsx",
      "Test: ChatApp renders header, message list, input",
      "Test: handleSubmit adds messages correctly",
      "Test: keyboard shortcuts work",
      "Create tests/ui/theme.test.ts",
      "Test: useTheme returns current theme",
      "Test: ThemeProvider passes theme to children",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.1: Create src/telemetry/types.ts with TelemetryEvent types",
    "steps": [
      "Create src/telemetry/types.ts file",
      "Define TelemetryEvent interface with eventId, timestamp, eventType, sessionId?, executionId?, properties",
      "Define TelemetryEventType union with SDK events (session.*, message.*, tool.*), graph events (graph.*, node.*, checkpoint.*), workflow events (workflow.*, feature.*), UI events (ui.*)",
      "Define TelemetryCollector interface with track(), flush(), isEnabled(), shutdown()",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.2: Create src/telemetry/collector.ts UnifiedTelemetryCollector class",
    "steps": [
      "Create src/telemetry/collector.ts file",
      "Implement UnifiedTelemetryCollector class implementing TelemetryCollector",
      "Add private events array, anonymousId, flushInterval",
      "Set batchSize to 100, flushIntervalMs to 30000 (30 seconds)",
      "Implement generateAnonymousId() using machine hash",
      "Implement constructor with config (enabled, localLogPath?, appInsightsKey?)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.3: Implement TelemetryCollector methods",
    "steps": [
      "In UnifiedTelemetryCollector, implement isEnabled()",
      "Check DO_NOT_TRACK and ATOMIC_TELEMETRY env vars",
      "Implement track() to add event with generated eventId and timestamp",
      "Add anonymousId, platform, nodeVersion to properties",
      "Auto-flush if batch size reached",
      "Implement flush() to write to local log and/or App Insights",
      "Implement shutdown() to clear interval and final flush",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.4: Implement writeToLocalLog() private method",
    "steps": [
      "In UnifiedTelemetryCollector, implement writeToLocalLog(events)",
      "Create log directory if needed using fs.mkdir",
      "Generate filename with date: telemetry-YYYY-MM-DD.jsonl",
      "Convert events to JSONL format (one JSON per line)",
      "Append to file using fs.appendFile",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.5: Implement sendToAppInsights() private method",
    "steps": [
      "In UnifiedTelemetryCollector, implement sendToAppInsights(events)",
      "Use Azure App Insights ingestion endpoint",
      "Transform events to App Insights EventData format",
      "Send POST request with JSON body",
      "Fail silently on network errors (telemetry should not break app)",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.6: Create src/telemetry/sdk-integration.ts",
    "steps": [
      "Create src/telemetry/sdk-integration.ts file",
      "Implement connectTelemetry(bridge, collector) function",
      "Subscribe to EventBridge events",
      "Call collector.track() with inferred event type",
      "Implement inferEventType() to map native events to TelemetryEventType",
      "Implement extractSessionId() helper",
      "Implement sanitizeForTelemetry() to remove sensitive fields",
      "Return unsubscribe function",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.7: Create src/telemetry/graph-integration.ts",
    "steps": [
      "Create src/telemetry/graph-integration.ts file",
      "Implement withGraphTelemetry(config, collector) function",
      "Return augmented GraphConfig with onProgress tracking",
      "Implement trackGraphExecution() returning started, completed, failed, checkpointSaved callbacks",
      "Track node execution events with duration",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.8: Create src/telemetry/config.ts",
    "steps": [
      "Create src/telemetry/config.ts file",
      "Define TelemetryConfig interface",
      "Implement loadTelemetryConfig() function",
      "Check DO_NOT_TRACK and ATOMIC_TELEMETRY env vars",
      "Set default localLogPath based on platform (XDG_DATA_HOME or LOCALAPPDATA)",
      "Read ATOMIC_APP_INSIGHTS_KEY from env",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 6.9: Add unit tests for telemetry",
    "steps": [
      "Create tests/telemetry/collector.test.ts",
      "Test: track() adds event to queue",
      "Test: flush() writes to JSONL file",
      "Test: isEnabled() respects DO_NOT_TRACK",
      "Test: auto-flush at batch size",
      "Create tests/telemetry/integration.test.ts",
      "Test: connectTelemetry receives events from bridge",
      "Test: trackGraphExecution tracks lifecycle",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.1: Create src/workflows/atomic.ts with createAtomicWorkflow function",
    "steps": [
      "Create src/workflows/atomic.ts file",
      "Import graph utilities and node factories",
      "Import AtomicWorkflowState type",
      "Implement createAtomicWorkflow(client) function skeleton",
      "Return compiled graph",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.2: Implement research node",
    "steps": [
      "In createAtomicWorkflow, create research agentNode",
      "Set agentType to 'codebase-research-analyzer'",
      "Set systemPrompt for analyzing codebase and research documents",
      "Map output to researchDoc state field",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.3: Implement createSpec node",
    "steps": [
      "In createAtomicWorkflow, create createSpec agentNode",
      "Set agentType to 'general'",
      "Set systemPrompt for creating technical specification",
      "Map output to specDoc state field",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.4: Implement reviewSpec and waitForApproval nodes",
    "steps": [
      "In createAtomicWorkflow, create reviewSpec decisionNode",
      "Route to createFeatureList if specApproved, else waitForApproval",
      "Create waitForApproval waitNode with spec review prompt",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.5: Implement createFeatureList node",
    "steps": [
      "In createAtomicWorkflow, create createFeatureList agentNode",
      "Set agentType to 'codebase-analyzer'",
      "Set systemPrompt for extracting features from spec",
      "Parse output as JSON feature list",
      "Map to featureList state field, set allFeaturesPassing to false",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.6: Implement selectFeature and implementFeature nodes",
    "steps": [
      "In createAtomicWorkflow, create selectFeature decisionNode",
      "Find first feature with passes=false",
      "Route to implementFeature if found, else createPR",
      "Create implementFeature agentNode",
      "Update feature in list to passes=true",
      "Increment iteration counter",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.7: Implement createPR node",
    "steps": [
      "In createAtomicWorkflow, create createPR toolNode",
      "Use gh tool with pr create subcommand",
      "Build args from state (title, body from specDoc)",
      "Map output (PR URL) to prUrl state field",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.8: Build and compile the atomic workflow graph",
    "steps": [
      "In createAtomicWorkflow, use graph() builder",
      "Chain: start('research').then(research).then(createSpec).then(reviewSpec).then(waitForApproval).then(createFeatureList)",
      "Add loop for implementFeature with until: allFeaturesPassing",
      "Add createPR after loop",
      "Mark createPR as end node",
      "Compile with ResearchDirSaver checkpointer",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.9: Implement FileSaver checkpointer",
    "steps": [
      "In src/graph/checkpointer.ts, implement FileSaver<TState> class",
      "Constructor takes directory path",
      "save() creates directory and writes JSON file",
      "load() reads and parses JSON file",
      "list() reads directory and returns execution IDs",
      "delete() removes file",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.10: Implement ResearchDirSaver checkpointer",
    "steps": [
      "In src/graph/checkpointer.ts, implement ResearchDirSaver<TState> class",
      "Constructor takes projectRoot (defaults to cwd)",
      "Store checkpoints in research/checkpoints/",
      "save() writes as .md with YAML frontmatter + JSON code block",
      "load() parses JSON from markdown code block",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.11: Update CLI to use graph engine for ralph command",
    "steps": [
      "Update atomic ralph setup command to use createAtomicWorkflow",
      "Add ATOMIC_USE_GRAPH_ENGINE feature flag check",
      "Create client based on -a flag",
      "Execute workflow with compiled graph",
      "Display progress via streaming state updates",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.12: Integrate OpenTUI chat interface with workflows",
    "steps": [
      "Update atomic run command to use startChatUI",
      "Create appropriate SDK client based on -a flag",
      "Configure session with system prompt and permissions",
      "Wire up telemetry collector",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 7.13: Add end-to-end tests for atomic workflow",
    "steps": [
      "Create tests/workflows/atomic.test.ts",
      "Test: workflow executes all nodes in order with mocked client",
      "Test: checkpoint saved after each node",
      "Test: human approval flow works",
      "Test: feature loop continues until all pass",
      "Test: PR created at end",
      "Run pnpm test to verify all pass"
    ],
    "passes": false
  },
  {
    "category": "refactor",
    "description": "Phase 8.1: Create graph module index file",
    "steps": [
      "Create src/graph/index.ts",
      "Export all types from ./types",
      "Export annotation utilities from ./annotation",
      "Export GraphBuilder and graph() from ./builder",
      "Export CompiledGraph from ./compiled",
      "Export checkpointer implementations from ./checkpointer",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "refactor",
    "description": "Phase 8.2: Create SDK module index file",
    "steps": [
      "Create src/sdk/index.ts",
      "Export types from ./types",
      "Export ClaudeAgentClient from ./claude-client",
      "Export OpenCodeClient from ./opencode-client",
      "Export CopilotClient from ./copilot-client",
      "Export EventBridge from ./event-bridge",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "refactor",
    "description": "Phase 8.3: Create telemetry module index file",
    "steps": [
      "Create src/telemetry/index.ts",
      "Export types from ./types",
      "Export UnifiedTelemetryCollector from ./collector",
      "Export connectTelemetry from ./sdk-integration",
      "Export withGraphTelemetry, trackGraphExecution from ./graph-integration",
      "Export loadTelemetryConfig from ./config",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "refactor",
    "description": "Phase 8.4: Create workflows module index file",
    "steps": [
      "Create src/workflows/index.ts",
      "Export createAtomicWorkflow from ./atomic",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 8.5: Add graph node factory functions",
    "steps": [
      "Create src/graph/nodes.ts file",
      "Define AgentNodeConfig<TState> interface",
      "Implement agentNode() factory function",
      "Define ToolNodeConfig<TState> interface",
      "Implement toolNode() factory function",
      "Define DecisionNodeConfig<TState> interface",
      "Implement decisionNode() factory function",
      "Define WaitNodeConfig<TState> interface",
      "Implement waitNode() factory function",
      "Define ParallelNodeConfig<TState> interface",
      "Implement parallelNode() factory function",
      "Run pnpm typecheck to verify"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 8.6: Run full test suite and fix issues",
    "steps": [
      "Run pnpm typecheck and fix any type errors",
      "Run pnpm lint and fix any lint errors",
      "Run pnpm test and fix any failing tests",
      "Ensure all new code has >80% test coverage",
      "Document any open issues or known limitations"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 8.7: Enable graph engine by default",
    "steps": [
      "Set ATOMIC_USE_GRAPH_ENGINE default to true",
      "Update README with graph engine documentation",
      "Document OpenTUI chat interface usage",
      "Document telemetry collection and opt-out options",
      "Create migration guide for existing Ralph users"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Phase 8.8: Create integration tests for full workflow",
    "steps": [
      "Create tests/e2e/graph-workflow.test.ts",
      "Test: atomic ralph setup -a claude executes full workflow",
      "Test: checkpoints created in research/checkpoints/",
      "Test: context compaction triggered at threshold",
      "Test: error recovery with retry",
      "Run tests with ATOMIC_USE_GRAPH_ENGINE=1"
    ],
    "passes": false
  }
]
