# Progress Log

## 2026-02-03 - Feature Implementation: Remove hook-based Ralph loop implementation files

### Status: COMPLETED

Removed all hook-based Ralph loop implementation files since the graph engine is now the only execution mode.

#### Files Removed
- `.github/hooks/ralph-stop.ts` - Hook-based Ralph stop handler for GitHub Copilot
- `.github/scripts/ralph-loop.ts` - Hook-based Ralph loop setup script
- `.github/scripts/start-ralph-session.ts` - Hook-based session start handler
- `.github/scripts/cancel-ralph.ts` - Hook-based cancel script
- `.github/skills/ralph/` directory - Skills for hook-based Ralph (SKILL.md, ralph-loop.md, cancel-ralph.md)
- `plugins/ralph/` directory - Plugin files for hook-based Ralph (hooks.json, commands/*.md, plugin.json)
- `tests/ralph/ralph-loop-integration.test.ts` - Integration tests for hook-based loop
- `tests/ralph/start-ralph-session.test.ts` - Tests for start-ralph-session.ts
- `tests/ralph/ralph-loop-cli.test.ts` - CLI tests for ralph-loop.ts
- `tests/ralph/cancel-ralph.test.ts` - Tests for cancel-ralph.ts
- `tests/ralph/yaml-frontmatter.test.ts` - Tests for YAML frontmatter parsing

#### Files Modified
- `src/commands/ralph.ts` - Removed `ralphStop()` function and related utility functions (readStdin, parseFrontmatter, extractPromptText, testAllFeaturesPassing, extractPromiseText, fileExists, RALPH_STATE_FILE constant, TranscriptMessage and FeatureItem types)
- `src/cli.ts` - Removed `ralphStop` import and `ralph stop` subcommand

#### Files Kept (SDK-native workflow)
- `src/workflows/ralph.ts` - SDK-native workflow definition
- `src/workflows/ralph-session.ts` - Session management for SDK-native workflow
- `src/workflows/ralph-executor.ts` - Workflow executor
- `src/graph/nodes/ralph-nodes.ts` - Graph nodes for Ralph workflow
- `src/config/ralph.ts` - Configuration for Ralph workflow
- `tests/ralph/ralph-graph-engine.test.ts` - Tests for graph-based workflow (13 tests pass)

#### Test Results
- Build passes successfully
- All 13 Ralph graph engine tests pass
- Pre-existing test failures in cli-commander.test.ts are unrelated to this change

---

## 2026-02-03 - Feature Implementation: Remove explicit hooks module from src/

### Status: COMPLETED

Removed the explicit hooks module from src/sdk/ as hooks are now passthrough to the underlying SDKs.

#### Background
The hooks system was originally designed to provide a unified interface for registering event handlers across all coding agent SDKs (Claude, OpenCode, Copilot). However, this is no longer needed because:
- Claude SDK handles .claude/settings.json hooks natively
- OpenCode SDK handles hooks natively
- Copilot SDK handles hooks natively

#### Files Removed
- `src/sdk/hooks.ts` - HookManager unified hook system (605 lines)
- `src/sdk/claude-hooks.ts` - Claude-specific SDK hooks (214 lines)
- `src/sdk/opencode-hooks.ts` - OpenCode-specific SDK hooks (846 lines)
- `src/sdk/copilot-hooks.ts` - Copilot-specific SDK hooks (590 lines)
- `tests/sdk/hooks.test.ts` - HookManager tests
- `tests/sdk/claude-hooks.test.ts` - Claude hooks tests
- `tests/sdk/opencode-hooks.test.ts` - OpenCode hooks tests
- `tests/sdk/copilot-hooks.test.ts` - Copilot hooks tests

#### Files Modified
- `src/sdk/index.ts` - Removed all hooks-related exports, added note explaining hooks are passthrough to underlying SDKs

#### Removed Exports
- `HookManager`, `createHookManager`
- Hook type exports: `UnifiedHookEvent`, `HookContext`, `HookHandler`, `HookResult`, `HookEventData`, `HookEventDataMap`
- Event data types: `BaseHookEventData`, `HookSessionStartEventData`, `HookSessionEndEventData`, `HookSessionErrorEventData`, `ToolBeforeEventData`, `ToolAfterEventData`, `ToolErrorEventData`, `MessageBeforeEventData`, `MessageAfterEventData`, `PermissionRequestEventData`, `HookSubagentStartEventData`, `SubagentEndEventData`
- Claude hook exports: `createSessionEndTelemetryHook`, `createDefaultClaudeHooks`, `createSessionStartHook`, `createPreToolUseHook`, `createPostToolUseHook`
- Copilot hook exports: `createCopilotSessionStartHandler`, `createCopilotSessionEndHandler`, `createCopilotUserPromptHandler`, `registerDefaultCopilotHooks`, `createDefaultCopilotHooks`, `CopilotHookHandlers`
- OpenCode hook exports: `createOpenCodeSessionStartHandler`, `createOpenCodeSessionIdleHandler`, `createOpenCodeSessionDeletedHandler`, `createOpenCodeCommandExecuteHandler`, `createOpenCodeChatMessageHandler`, `registerDefaultOpenCodeHooks`, `createDefaultOpenCodeHooks`, `parseRalphState`, `writeRalphState`, `deleteRalphState`, `checkFeaturesPassing`, `checkCompletionPromise`, `normalizeCommandName`, `extractCommandsFromText`, `OpenCodeHookHandlers`, `OpenCodeHookContext`

#### Test Results
- Build passes successfully
- All 162 SDK tests pass (hooks tests removed)
- All tests pass (2962 pass, 17 fail - pre-existing failures unrelated to hooks)

---

## 2026-02-03 - Feature Implementation: Define RalphWorkflowState interface in graph/annotation.ts

### Status: COMPLETED

Implemented the `RalphWorkflowState` interface in `src/graph/annotation.ts` for the Ralph autonomous feature implementation workflow.

#### Implementation Details
- **Location**: src/graph/annotation.ts (lines 422-543)
- **Interface Fields**:
  - Base state fields: `executionId`, `lastUpdated`, `outputs`
  - Workflow fields: `researchDoc`, `specDoc`, `specApproved`, `featureList`, `currentFeature`, `allFeaturesPassing`, `contextWindowUsage`, `iteration`, `prUrl`, `debugReports`
  - Ralph-specific fields: `ralphSessionId`, `ralphSessionDir`, `yolo`, `yoloPrompt`, `yoloComplete`, `maxIterations`, `shouldContinue`, `prBranch`, `completedFeatures`, `sourceFeatureListPath`, `maxIterationsReached`

#### Added Exports
- `RalphWorkflowState` type
- `RalphStateAnnotation` annotation schema
- `createRalphState()` factory function
- `updateRalphState()` state update function
- `isRalphWorkflowState()` type guard

#### Tests Added (27 new tests in tests/graph/annotation.test.ts)
- RalphStateAnnotation field tests (3 tests)
- createRalphState tests (8 tests)
- updateRalphState tests (6 tests)
- isRalphWorkflowState tests (6 tests)
- Type inference tests (4 tests)

#### Test Results
- All 77 tests in tests/graph/annotation.test.ts pass
- All 524 tests in tests/graph/ pass

#### Files Modified
- src/graph/annotation.ts - Added RalphWorkflowState interface, annotation schema, factory functions, and type guard
- src/graph/index.ts - Added exports for RalphWorkflowState, RalphStateAnnotation, createRalphState, updateRalphState, isRalphWorkflowState
- tests/graph/annotation.test.ts - Added 27 new tests
- research/feature-list.json - Updated passes to true

---

## 2026-02-03 - Feature Verification: Define CommandDefinition interface in registry.ts

### Status: VERIFIED - Already Implemented

The CommandDefinition interface was already properly defined in src/ui/commands/registry.ts with all required fields.

#### Implementation Details
- **Location**: src/ui/commands/registry.ts (lines 107-120)
- **Interface Fields**:
  - `name: string` - Primary command name (without leading slash)
  - `description: string` - Human-readable description
  - `category: CommandCategory` - Command category for grouping
  - `execute: (args, context) => CommandResult | Promise<CommandResult>` - Function to execute the command
  - `aliases?: string[]` - Alternative names for the command
  - `hidden?: boolean` - Whether to hide from autocomplete list

#### Test Results
- All 35 tests in tests/ui/commands/registry.test.ts pass
- Tests cover command registration, lookup, search, and execution

#### Files Verified
- src/ui/commands/registry.ts - Contains complete CommandDefinition interface
- tests/ui/commands/registry.test.ts - Contains comprehensive tests for the interface

---

## 2026-02-03 - Feature Implementation: Wire handleAskUserQuestion to human_input_required event

### Completed
- Added `human_input_required` to `EventType` union in src/sdk/types.ts
  - Now includes all 11 event types including the new workflow graph event

- Added new SDK types:
  - `HumanInputOption` interface - Option structure for human_input_required events (label, description)
  - `HumanInputRequiredEventData` interface - Event data structure with requestId, question, header, options, nodeId, respond callback
  - Updated `EventDataMap` to include mapping for `human_input_required` event type

- Added askUserQuestion handler wiring in src/ui/index.ts:
  - Added `askUserQuestionHandler: OnAskUserQuestion | null` to `ChatUIState` interface
  - Initialized `askUserQuestionHandler: null` in state initialization
  - Created `registerAskUserQuestionHandler` callback that stores handler in state
  - Added subscription for `human_input_required` events in `subscribeToToolEvents()`
  - Event handler transforms event data to AskUserQuestionEventData format and calls registered handler
  - Added cleanup for the subscription in the unsubscribe function
  - Passed `registerAskUserQuestionHandler` to ChatApp props

- Added exports:
  - Exported `OnAskUserQuestion` type from src/ui/index.ts
  - Exported `HumanInputOption`, `HumanInputRequiredEventData`, `PermissionOption`, `PermissionRequestedEventData` from src/sdk/index.ts

### Test Results
- Added 8 new tests for human_input_required event wiring in tests/ui/chat.test.ts:
  - event listener receives human_input_required event data
  - event handler transforms event data to AskUserQuestionEventData format
  - event handler does not call askUserQuestionHandler if required fields are missing
  - event listener is set up during subscription
  - event listener is cleaned up on unsubscribe
  - registered handler is called with correct event data
  - options array is passed through correctly
  - optional header field is handled correctly

- Added 3 new tests for human_input_required event type in tests/sdk/types.test.ts:
  - includes all expected event types (updated from 9 to 11)
  - creates human_input_required event
  - creates human_input_required event without optional fields

- All tests pass:
  - tests/ui/chat.test.ts: 130 pass
  - tests/sdk/types.test.ts: 31 pass

### Files Modified
- src/sdk/types.ts - Added human_input_required to EventType, HumanInputOption, HumanInputRequiredEventData interfaces, updated EventDataMap
- src/sdk/index.ts - Added new type exports
- src/ui/index.ts - Added askUserQuestionHandler state, registration callback, event subscription, ChatApp prop
- tests/ui/chat.test.ts - Added 8 new tests
- tests/sdk/types.test.ts - Added 3 new tests

---

## 2026-02-03 - Feature Implementation: handleAskUserQuestion() in chat.tsx

### Completed
- Added `OnAskUserQuestion` callback type in src/ui/chat.tsx
  - Accepts `AskUserQuestionEventData` parameter from askUserNode
  - Type: `(eventData: AskUserQuestionEventData) => void`

- Added new ChatAppProps fields:
  - `registerAskUserQuestionHandler?: (handler: OnAskUserQuestion) => void` - Registration callback for askUserNode events
  - `onWorkflowResumeWithAnswer?: (requestId: string, answer: string | string[]) => void` - Callback to resume workflow with user's answer

- Added `askUserQuestionRequestIdRef` ref to store the requestId for response correlation

- Implemented `handleAskUserQuestion` callback:
  - Stores requestId in ref for response correlation
  - Converts `AskUserQuestionEventData` to `UserQuestion` format
  - Uses header or defaults to "Question"
  - Maps options using label as value (since AskUserOption only has label/description)
  - Shows question dialog via `handleHumanInputRequired`

- Added registration effect hook for `registerAskUserQuestionHandler`

- Updated `handleQuestionAnswer` to handle askUserNode responses:
  - Checks if `askUserQuestionRequestIdRef.current` is set
  - Clears the ref after processing
  - If `workflowState.workflowActive && onWorkflowResumeWithAnswer`:
    - Calls `onWorkflowResumeWithAnswer(requestId, answer.selected)` for workflow mode
  - Otherwise (standalone agent mode):
    - Gets session via `getSession()`
    - Sends answer through `session.send()` with array values joined by comma
  - Updated useCallback dependencies

- Imported `AskUserQuestionEventData` type from `../graph/index.ts`

### Tests Added (14 new tests)
- handleAskUserQuestion tests:
  - AskUserQuestionEventData has required fields
  - AskUserQuestionEventData with optional header
  - AskUserQuestionEventData with options array
  - conversion to UserQuestion format uses header or default
  - conversion preserves options with label as value
  - empty options array produces empty UserQuestion options

- handleAskUserQuestion response flow tests:
  - workflow mode calls onWorkflowResumeWithAnswer
  - standalone mode calls session.send
  - array answer is joined with comma for session.send
  - no action when session is null in standalone mode

- ChatAppProps with askUserQuestion handlers tests:
  - ChatAppProps includes registerAskUserQuestionHandler
  - ChatAppProps includes onWorkflowResumeWithAnswer
  - both handlers can be used together

- OnAskUserQuestion callback type tests:
  - accepts AskUserQuestionEventData parameter

### Test Results
- All chat.test.ts tests pass (122 tests, up from 108)
- All UI commands tests pass (621 tests)

### Files Modified
- src/ui/chat.tsx - Added handleAskUserQuestion callback, new props, updated handleQuestionAnswer
- tests/ui/chat.test.ts - Added 14 new tests for handleAskUserQuestion

---

## 2026-02-03 - Feature Implementation: askUserNode with human_input_required event

### Completed
- Added `"ask_user"` to NodeType enum in src/graph/types.ts
  - New node type specifically for explicit human-in-the-loop questions
  - Distinct from legacy `"wait"` type

- Defined AskUserOptions interface in src/graph/nodes.ts
  - `question: string` - The question to ask the user
  - `header?: string` - Short label for UI display
  - `options?: AskUserOption[]` - Structured options for user choice

- Defined AskUserOption interface
  - `label: string` - Display label for the option
  - `description: string` - Detailed description

- Defined AskUserNodeConfig interface for node configuration
  - `id: NodeId` - Unique identifier
  - `options: AskUserOptions | ((state) => AskUserOptions)` - Static or dynamic options
  - `name?: string` - Human-readable name
  - `description?: string` - Node description

- Defined AskUserWaitState interface for state extension
  - `__waitingForInput?: boolean` - Wait flag
  - `__waitNodeId?: string` - Node ID waiting for input
  - `__askUserRequestId?: string` - Request correlation ID

- Defined AskUserQuestionEventData interface for event data
  - `requestId: string` - UUID for correlating responses
  - `question: string` - The question
  - `header?: string` - Optional header
  - `options?: AskUserOption[]` - Optional structured options
  - `nodeId: string` - The asking node's ID

- Implemented askUserNode() function
  - Creates node with type `"ask_user"`
  - Generates unique requestId using `crypto.randomUUID()`
  - Emits `human_input_required` signal with full event data
  - Sets `__waitingForInput: true` in state
  - Sets `__waitNodeId` to node id in state
  - Sets `__askUserRequestId` for response correlation
  - Calls `ctx.emit()` when available
  - Supports both static and function-based options

- Updated src/graph/index.ts exports
  - Added type exports: AskUserOption, AskUserOptions, AskUserNodeConfig, AskUserWaitState, AskUserQuestionEventData
  - Added value export: askUserNode

### Tests Added (14 new tests)
- askUserNode tests:
  - creates node with correct type and id
  - uses provided name and description
  - emits human_input_required signal with question
  - generates unique requestId using crypto.randomUUID()
  - sets __waitingForInput to true in state update
  - sets __waitNodeId to node id in state update
  - sets __askUserRequestId in state update
  - includes options array in signal data
  - uses options function with state
  - calls emit function when available
  - works without emit function
  - handles empty options array
  - handles missing optional fields
  - generates different requestIds for each execution

### Test Results
- All nodes.test.ts tests pass (95 tests, up from 81)
- All graph tests pass (497 tests)

### Files Modified
- src/graph/types.ts - Added "ask_user" to NodeType enum
- src/graph/nodes.ts - Added AskUserOptions, AskUserNodeConfig, AskUserWaitState, AskUserQuestionEventData interfaces and askUserNode() function
- src/graph/index.ts - Added new type and value exports
- tests/graph/nodes.test.ts - Added 14 new tests for askUserNode

---

## 2026-02-03 - Feature Implementation: Update subgraphNode() to accept workflow name string

### Completed
- Updated SubgraphNodeConfig interface in src/graph/nodes.ts
  - Added CompiledSubgraph<TSubState> interface for typed subgraph execution
  - Added SubgraphRef<TSubState> type as union of CompiledSubgraph | string
  - Updated subgraph field to accept SubgraphRef (either compiled graph or workflow name string)
  - Added comprehensive JSDoc documentation for the new type

- Implemented WorkflowResolver dependency injection pattern
  - Added WorkflowResolver type for workflow name resolution function
  - Added globalWorkflowResolver module-level variable
  - Added setWorkflowResolver() to set the global resolver
  - Added getWorkflowResolver() to get the current resolver
  - This pattern avoids circular dependencies between nodes.ts and workflow-commands.ts

- Updated subgraphNode() function to handle string workflow references
  - If subgraph is a string, resolve via globalWorkflowResolver
  - Throws clear error if no resolver is set: "Cannot resolve workflow \"{name}\": No workflow resolver set"
  - Throws "Workflow not found: {name}" if resolver returns null
  - If subgraph is a CompiledGraph, use directly (existing behavior)
  - Both paths execute the subgraph and return result

- Integrated workflow resolver with workflow-commands.ts
  - Added import for setWorkflowResolver in workflow-commands.ts
  - Added initializeWorkflowResolver() function to set resolveWorkflowRef as the global resolver
  - Updated registerWorkflowCommands() to call initializeWorkflowResolver() automatically
  - Exported initializeWorkflowResolver and resolveWorkflowRef from index.ts

- Updated src/graph/index.ts exports
  - Added CompiledSubgraph, SubgraphRef, WorkflowResolver type exports
  - Added setWorkflowResolver, getWorkflowResolver value exports

### Tests Added
- subgraphNode with string workflow reference tests (9 tests):
  - setWorkflowResolver sets the global resolver
  - getWorkflowResolver returns null when not set
  - resolves workflow by name and executes it
  - throws error when no workflow resolver is set
  - throws error when workflow is not found
  - stores resolved subgraph result in outputs without mapper
  - uses inputMapper when resolving workflow by name
  - compiled graph still works when string is not provided
  - accepts any workflow name string

### Test Results
- All nodes.test.ts tests pass (81 tests, up from 72)
- All graph tests pass (483 tests)
- All workflow-commands tests pass (122 tests)
- All UI commands tests pass (513 tests)

### Files Modified
- src/graph/nodes.ts - Added CompiledSubgraph, SubgraphRef types, WorkflowResolver pattern, updated subgraphNode()
- src/graph/index.ts - Added new type and value exports
- src/ui/commands/workflow-commands.ts - Added initializeWorkflowResolver(), updated registerWorkflowCommands()
- src/ui/commands/index.ts - Added initializeWorkflowResolver and resolveWorkflowRef exports
- tests/graph/nodes.test.ts - Added 9 new tests for string workflow reference

---

## 2026-02-03 - Feature Implementation: Workflow Registry and Resolution

### Completed
- Implemented workflowRegistry Map for workflow lookup in workflow-commands.ts
  - Created module-level workflowRegistry: Map<string, WorkflowMetadata>
  - Added registryInitialized flag to track initialization state
  - Created initializeRegistry() function to populate registry from getAllWorkflows()
  - Registry includes both built-in and dynamically loaded workflows
  - Registry maps both primary names and aliases (case-insensitive)

- Implemented resolutionStack Set for circular dependency detection
  - Created module-level resolutionStack: Set<string>
  - Used to track current workflow resolution chain
  - Cleared after each resolution completes (in finally block)

- Implemented resolveWorkflowRef() function for subgraph workflow lookup
  - Function signature: resolveWorkflowRef(name: string): CompiledGraph<BaseState> | null
  - Checks resolutionStack for circular dependency before resolution
  - Throws Error with dependency chain on circular reference: 'Circular workflow dependency detected: A -> B -> A'
  - Adds name to resolutionStack during resolution
  - Looks up workflow in registry via getWorkflowFromRegistry()
  - Creates workflow with defaultConfig
  - Removes name from resolutionStack in finally block (always cleans up)
  - Returns compiled graph or null if not found

- Added helper functions:
  - getWorkflowFromRegistry(name): Find workflow by name/alias
  - hasWorkflow(name): Check if workflow exists in registry
  - getWorkflowNames(): Get array of all workflow names
  - refreshWorkflowRegistry(): Clear and reinitialize registry

### Tests Added
- loadWorkflowsFromDisk tests (5 tests):
  - returns empty array when no workflow files exist
  - loads workflow from valid .ts file
  - skips workflow file without default export function
  - uses filename as name when module.name is not defined
  - provides default description when not exported

- getAllWorkflows tests (2 tests):
  - returns array including built-in workflows
  - workflows have required fields

- workflow loading priority tests (3 tests):
  - local workflows marked with source 'local'
  - built-in workflows marked with source 'builtin'
  - deduplicates workflows by name (case-insensitive)

- workflowRegistry tests (9 tests):
  - getWorkflowFromRegistry finds workflow by name
  - getWorkflowFromRegistry finds workflow by alias
  - getWorkflowFromRegistry is case-insensitive
  - getWorkflowFromRegistry returns undefined for unknown workflow
  - hasWorkflow returns true for registered workflow
  - hasWorkflow returns false for unknown workflow
  - hasWorkflow is case-insensitive
  - getWorkflowNames returns array of workflow names
  - refreshWorkflowRegistry reinitializes registry

- resolveWorkflowRef tests (5 tests):
  - resolves workflow by name
  - resolves workflow by alias
  - is case-insensitive
  - returns null for unknown workflow
  - applies default config when resolving

- circular dependency detection tests (2 tests):
  - resolveWorkflowRef clears resolution stack after successful resolution
  - resolveWorkflowRef clears resolution stack after failed resolution

### Test Results
- All workflow-commands tests pass (122 tests)
- Total expect() calls: 299

### Features Marked as Passing
- discoverWorkflowFiles() to find .ts files in search paths
- loadWorkflowsFromDisk() to dynamically import workflow modules
- Validate required exports in custom workflow files
- Local workflow override of global workflows
- Create workflowRegistry Map for workflow lookup
- Implement resolveWorkflowRef() for subgraph workflow lookup
- Create resolutionStack Set for circular dependency detection
- Implement circular dependency detection in resolveWorkflowRef()

### Files Modified
- src/ui/commands/workflow-commands.ts - Added workflowRegistry, resolutionStack, resolveWorkflowRef(), and helper functions
- tests/ui/commands/workflow-commands.test.ts - Added 26 new tests for workflow registry and resolution

---

## 2026-02-03 - Feature Implementation: CUSTOM_WORKFLOW_SEARCH_PATHS Constant

### Completed
- Defined and exported CUSTOM_WORKFLOW_SEARCH_PATHS constant in workflow-commands.ts
  - Array of paths to search for custom workflow definitions
  - `.atomic/workflows` for project-local workflows (highest priority)
  - `~/.atomic/workflows` for user-global workflows (lower priority)
  - Added comprehensive JSDoc documentation with examples
- Added expandPath() helper function to resolve ~ paths
  - Expands ~/path to $HOME/path
  - Expands ~path to $HOME/path
  - Resolves relative paths from process.cwd()
- Updated discoverWorkflowFiles() function
  - Now uses CUSTOM_WORKFLOW_SEARCH_PATHS constant instead of hardcoded paths
  - Uses expandPath() for proper path expansion
  - Added detailed documentation about search order

### Tests Added
- CUSTOM_WORKFLOW_SEARCH_PATHS tests:
  - is exported as an array
  - has correct number of paths (2)
  - contains .atomic/workflows for project-local workflows
  - contains ~/.atomic/workflows for user-global workflows
  - local path comes before global path (higher priority)
  - local path is first element
  - global path is second element
- discoverWorkflowFiles tests:
  - returns empty array when no workflow directories exist
  - discovers .ts files in local workflow directory
  - marks local workflows with source 'local'
  - ignores non-.ts files
  - returns absolute paths

### Test Results
- All workflow-commands tests pass (96 tests)
- All UI commands tests pass (487 tests)

### Files Modified
- src/ui/commands/workflow-commands.ts - Added CUSTOM_WORKFLOW_SEARCH_PATHS constant and expandPath() helper
- tests/ui/commands/workflow-commands.test.ts - Added CUSTOM_WORKFLOW_SEARCH_PATHS and discoverWorkflowFiles tests

---

## 2026-02-03 - Feature Implementation: Remove /reject Command Registration

### Completed
- Removed /reject command from builtin-commands.ts
  - Removed rejectCommand export and definition
  - Removed from builtinCommands array (now 5 commands)
  - Updated file header comment
- Updated /status command message
  - Changed from "Use `/reject <feedback>` to revise or continue manually" to "Review the spec and continue manually or revise."
- Updated index.ts
  - Removed rejectCommand from exports
  - Updated comment: "Built-in commands (help, status, theme, clear, compact)"
- Updated cli.ts
  - Removed /reject from slash commands help text
- Updated chat.ts
  - Removed /reject command handler block
  - Updated help message to remove /reject
  - Updated approval prompt from mentioning /reject to "Review the spec and type any message to continue, or revise manually."
  - Simplified approval callback logic (no longer checking for "reject" in message)

### Tests Updated
- tests/ui/commands/builtin-commands.test.ts
  - Removed rejectCommand import
  - Removed entire rejectCommand test suite
  - Updated builtinCommands array test (5 commands instead of 6)
  - Removed rejectCommand from "contains all built-in commands" test
  - Updated "registers all built-in commands" test to verify reject is NOT registered
  - Removed "no" alias test (was rejectCommand alias)
  - Updated idempotent test (size 5 instead of 6)
  - Updated pending approval state test to not expect /reject in message
- tests/ui/commands/index.test.ts
  - Updated expect for globalRegistry.has("reject") to be false
  - Added expect for globalRegistry.has("compact") to be true

### Test Results
- All UI commands tests pass (492 tests)
- All builtin-commands tests pass (37 tests)
- All index tests pass (31 tests)

### Files Modified
- src/ui/commands/builtin-commands.ts - Removed /reject command
- src/ui/commands/index.ts - Removed rejectCommand export
- src/cli.ts - Removed /reject from help text
- src/commands/chat.ts - Removed /reject handling, updated messages
- tests/ui/commands/builtin-commands.test.ts - Removed rejectCommand tests
- tests/ui/commands/index.test.ts - Updated reject registration test

---

## 2026-02-03 - Feature Implementation: Remove /approve Command Registration

### Completed
- Removed /approve command from builtin-commands.ts
  - Removed approveCommand export and definition
  - Removed from builtinCommands array
  - Updated command count from 7 to 6
- Updated /status command message to remove /approve reference
  - Changed "Use `/approve` or `/reject <feedback>` to continue" to "Use `/reject <feedback>` to revise or continue manually"
- Updated index.ts
  - Removed approveCommand from exports
  - Updated comment to remove /approve from list
- Updated cli.ts
  - Removed /approve from slash commands help text
- Updated chat.ts
  - Removed /approve command handler block
  - Updated help message to remove /approve
  - Changed approval prompt from "Type `/approve` to proceed or `/reject`" to "Type `/reject <feedback>` to request revisions or continue manually."
  - Updated approval callback logic: any input continues workflow, explicit "reject" rejects

### Tests Updated
- tests/ui/commands/builtin-commands.test.ts
  - Removed approveCommand import
  - Removed entire approveCommand test suite
  - Updated builtinCommands array test (6 commands instead of 7)
  - Removed "ok" and "yes" alias tests (those were approveCommand aliases)
  - Updated registerBuiltinCommands idempotent test (size 6 instead of 7)
  - Updated pending approval state test to not expect /approve in message
- tests/ui/commands/index.test.ts
  - Removed expect for globalRegistry.has("approve")
  - Added note: "/approve removed - spec approval is now manual before workflow"

### Test Results
- All UI commands tests pass (498 tests)
- All builtin-commands tests pass (43 tests)
- All index tests pass (31 tests)

### Files Modified
- src/ui/commands/builtin-commands.ts - Removed /approve command
- src/ui/commands/index.ts - Removed approveCommand export
- src/cli.ts - Removed /approve from help text
- src/commands/chat.ts - Removed /approve handling, updated messages
- tests/ui/commands/builtin-commands.test.ts - Removed approveCommand tests
- tests/ui/commands/index.test.ts - Removed approve registration test

---

## 2026-02-03 - Feature Implementation: Remove /ralph:ralph-help and Integrate into /help

### Completed
- Verified /ralph:ralph-help command already removed from SKILL_DEFINITIONS
- Updated /help command to include Ralph workflow documentation when /ralph is registered
- Added comprehensive Ralph workflow help section with:
  - Usage examples for default mode, --yolo mode, and --resume
  - Option documentation for --feature-list and --max-iterations
  - Interrupt instructions (Ctrl+C or Esc to pause)
  - Resume instructions with session UUID
- Fixed pre-existing test failures in builtin-commands.test.ts
  - Updated expected command count from 6 to 7 (includes compactCommand)
  - Added compactCommand to import and array containment tests

### Tests Added
- helpCommand shows Ralph workflow documentation when /ralph is registered
- helpCommand does not show Ralph documentation when /ralph is not registered

### Test Results
- All UI commands tests pass (502 tests)
- All builtin-commands tests pass (47 tests)
- All skill-commands tests pass (107 tests)

### Files Modified
- src/ui/commands/builtin-commands.ts - Updated /help to include Ralph workflow docs
- tests/ui/commands/builtin-commands.test.ts - Fixed command count, added Ralph help tests

## 2026-02-02 - Feature Implementation: BuiltinSkill Interface

### Completed
- Created BuiltinSkill interface in skill-commands.ts
  - Added name: string field (skill name without leading slash)
  - Added description: string field (human-readable description)
  - Added aliases?: string[] field (alternative command names)
  - Added prompt: string field (full prompt content with $ARGUMENTS support)
  - Added hidden?: boolean field (hide from autocomplete)
  - Exported the interface for use in other modules

### Tests Added
- Added test suite for BuiltinSkill interface:
  - Valid BuiltinSkill has all required fields
  - BuiltinSkill supports optional aliases
  - BuiltinSkill supports optional hidden flag
  - BuiltinSkill with all optional fields

### Test Results
- All skill-commands tests pass (37 tests)
- Note: Some pre-existing test failures in other modules (builtin-commands count mismatch)

### Files Modified
- src/ui/commands/skill-commands.ts - Added BuiltinSkill interface
- tests/ui/commands/skill-commands.test.ts - Added BuiltinSkill tests

## 2026-02-02 - Feature Implementation: Commit Skill as Builtin

### Completed
- Added BUILTIN_SKILLS array with commit skill in skill-commands.ts
  - Set name to 'commit'
  - Set description to 'Create well-formatted commits with conventional commit format'
  - Set aliases to ['ci']
  - Embedded full conventional commit prompt with git commands and guidelines
  - Included $ARGUMENTS placeholder for user arguments
- Added getBuiltinSkill() helper function to look up builtin skills by name/alias
- Updated createSkillCommand() to check builtin skills first before disk-based loading
- Priority order: builtin skill > disk-based skill > slash command fallback

### Tests Added
- BUILTIN_SKILLS tests:
  - contains commit skill with correct fields
  - commit skill has $ARGUMENTS placeholder
  - commit skill includes conventional commit guidelines
  - commit skill includes git commands
  - all builtin skills have required fields
- getBuiltinSkill tests:
  - finds builtin skill by name
  - finds builtin skill by alias
  - is case-insensitive
  - returns undefined for non-builtin skill
  - returns undefined for unknown skill
- builtin skill execution tests:
  - commit command uses embedded prompt
  - commit command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (49 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added BUILTIN_SKILLS array and getBuiltinSkill()
- tests/ui/commands/skill-commands.test.ts - Added BUILTIN_SKILLS and execution tests

## 2026-02-02 - Feature Implementation: Research-Codebase Skill as Builtin

### Completed
- Added research-codebase skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'research-codebase'
  - Set description to 'Document codebase as-is with research directory for historical context'
  - Set aliases to ['research']
  - Embedded comprehensive prompt for analyzing and documenting codebase
  - Included instructions for creating research/ directory artifacts:
    - research/architecture.md - High-level architecture documentation
    - research/directory-structure.md - Directory structure mapping
    - research/tech-stack.md - Technology stack catalog
    - research/entry-points.md - Entry points and execution flows
    - research/patterns.md - Coding patterns and conventions
    - research/data-models.md - Data structures and schemas
    - research/dependencies.md - External dependencies analysis
  - Included $ARGUMENTS placeholder for focused analysis (e.g., specific modules)
  - Added guidelines for objective, factual documentation

### Tests Added
- BUILTIN_SKILLS tests:
  - contains research-codebase skill with correct fields
  - research-codebase skill has $ARGUMENTS placeholder
  - research-codebase skill includes research directory structure
  - research-codebase skill includes documentation guidelines
- getBuiltinSkill tests:
  - finds research-codebase builtin skill by name
  - finds research-codebase builtin skill by alias
- builtin skill execution tests:
  - research-codebase command uses embedded prompt
  - research-codebase command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (57 tests)
- Note: Pre-existing test failures in builtin-commands module remain (count mismatch)

### Files Modified
- src/ui/commands/skill-commands.ts - Added research-codebase to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added research-codebase tests

## 2026-02-02 - Feature Implementation: Create-Spec Skill as Builtin

### Completed
- Added create-spec skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'create-spec'
  - Set description to 'Generate technical specification from research'
  - Set aliases to ['spec']
  - Embedded comprehensive prompt for generating technical specifications
  - Included instructions for creating research/spec.md with sections:
    - Overview - Feature summary and goals
    - Technical Approach - Design decisions and alternatives
    - Component Design - Module interfaces and dependencies
    - Data Model Changes - Types and schema changes
    - API Changes - Endpoints and breaking changes
    - Integration Points - System integration details
    - Error Handling - Error scenarios and recovery
    - Testing Strategy - Test requirements
    - Implementation Order - Suggested sequence
    - Open Questions - Unresolved decisions
  - Referenced research directory artifacts as input sources
  - Included $ARGUMENTS placeholder for feature/refactor description

### Tests Added
- BUILTIN_SKILLS tests:
  - contains create-spec skill with correct fields
  - create-spec skill has $ARGUMENTS placeholder
  - create-spec skill includes spec structure sections
  - create-spec skill references research directory
- getBuiltinSkill tests:
  - finds create-spec builtin skill by name
  - finds create-spec builtin skill by alias
- builtin skill execution tests:
  - create-spec command uses embedded prompt
  - create-spec command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (65 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added create-spec to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added create-spec tests

## 2026-02-02 - Feature Implementation: Create-Feature-List Skill as Builtin

### Completed
- Added create-feature-list skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'create-feature-list'
  - Set description to 'Break spec into implementable tasks'
  - Set aliases to ['features']
  - Embedded comprehensive prompt for creating feature-list.json
  - Included JSON schema for feature list format with fields:
    - category (functional, refactor, test, documentation, ui, e2e)
    - description (brief description of the feature)
    - steps (ordered list of implementation steps)
    - passes (boolean for test status, initially false)
  - Added instructions for creating research/progress.txt
  - Included feature breakdown guidelines and ordering rules
  - Included $ARGUMENTS placeholder for focused breakdown

### Tests Added
- BUILTIN_SKILLS tests:
  - contains create-feature-list skill with correct fields
  - create-feature-list skill has $ARGUMENTS placeholder
  - create-feature-list skill includes JSON schema
  - create-feature-list skill includes feature categories
- getBuiltinSkill tests:
  - finds create-feature-list builtin skill by name
  - finds create-feature-list builtin skill by alias
- builtin skill execution tests:
  - create-feature-list command uses embedded prompt
  - create-feature-list command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (73 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added create-feature-list to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added create-feature-list tests

## 2026-02-02 - Feature Implementation: Implement-Feature Skill as Builtin

### Completed
- Added implement-feature skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'implement-feature'
  - Set description to 'Implement next feature from list'
  - Set aliases to ['impl']
  - Embedded comprehensive prompt for implementing features from feature-list.json
  - Included complete implementation process:
    - Load feature list and identify next feature
    - Review feature context (description, steps, category)
    - Implement each step
    - Write tests for new functionality
    - Update feature status (passes: true) after completion
  - Added feature categories explanation (functional, refactor, test, documentation, ui, e2e)
  - Included progress tracking instructions for research/progress.txt
  - Included error handling guidelines
  - Included $ARGUMENTS placeholder for specific feature targeting

### Tests Added
- BUILTIN_SKILLS tests:
  - contains implement-feature skill with correct fields
  - implement-feature skill has $ARGUMENTS placeholder
  - implement-feature skill includes implementation process
  - implement-feature skill includes feature categories
- getBuiltinSkill tests:
  - finds implement-feature builtin skill by name
  - finds implement-feature builtin skill by alias
- builtin skill execution tests:
  - implement-feature command uses embedded prompt
  - implement-feature command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (81 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added implement-feature to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added implement-feature tests

## 2026-02-02 - Feature Implementation: Create-GH-PR Skill as Builtin

### Completed
- Added create-gh-pr skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'create-gh-pr'
  - Set description to 'Push and create pull request'
  - Set aliases to ['pr']
  - Embedded comprehensive prompt for creating GitHub PRs
  - Included complete PR workflow:
    - Check repository state (branch, remote, uncommitted changes)
    - Commit changes if needed
    - Push to remote with upstream tracking
    - Create PR using gh CLI
  - Added PR template format with Summary, Changes, Testing sections
  - Included gh CLI commands reference (create, view, list PRs)
  - Added guidelines for PR title, description, and branch naming
  - Included error handling for common issues
  - Included $ARGUMENTS placeholder for PR title

### Tests Added
- BUILTIN_SKILLS tests:
  - contains create-gh-pr skill with correct fields
  - create-gh-pr skill has $ARGUMENTS placeholder
  - create-gh-pr skill includes gh CLI commands
  - create-gh-pr skill includes PR template format
- getBuiltinSkill tests:
  - finds create-gh-pr builtin skill by name
  - finds create-gh-pr builtin skill by alias
- builtin skill execution tests:
  - create-gh-pr command uses embedded prompt
  - create-gh-pr command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (89 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added create-gh-pr to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added create-gh-pr tests

## 2026-02-02 - Feature Implementation: Explain-Code Skill as Builtin

### Completed
- Added explain-code skill to BUILTIN_SKILLS array in skill-commands.ts
  - Set name to 'explain-code'
  - Set description to 'Explain code functionality in detail'
  - Set aliases to ['explain']
  - Embedded comprehensive prompt for explaining code functionality
  - Included explanation structure covering:
    - Overview - What the code does
    - Structure Analysis - Components and organization
    - Control Flow - Execution order and paths
    - Data Flow - Inputs, transformations, outputs
    - Key Algorithms - Patterns and complexity
    - Error Handling - Detection and recovery
    - Side Effects - External state modifications
    - Dependencies - External libraries used
  - Supported input types:
    - File Path (e.g., src/utils/parser.ts)
    - File Path with Line Range (e.g., src/utils/parser.ts:10-50)
    - Function or Class Name
    - Code Selection
    - Conceptual Query
  - Included $ARGUMENTS placeholder for code path/selection
  - Added guidelines for clear, thorough explanations

### Tests Added
- BUILTIN_SKILLS tests:
  - contains explain-code skill with correct fields
  - explain-code skill has $ARGUMENTS placeholder
  - explain-code skill includes explanation structure
  - explain-code skill includes input types
- getBuiltinSkill tests:
  - finds explain-code builtin skill by name
  - finds explain-code builtin skill by alias
- builtin skill execution tests:
  - explain-code command uses embedded prompt
  - explain-code command expands $ARGUMENTS with provided args

### Test Results
- All skill-commands tests pass (97 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added explain-code to BUILTIN_SKILLS array
- tests/ui/commands/skill-commands.test.ts - Added explain-code tests

## 2026-02-02 - Feature Implementation: registerBuiltinSkills() and $ARGUMENTS expansion

### Completed
- Created `registerBuiltinSkills()` function in skill-commands.ts
  - Iterates over BUILTIN_SKILLS array
  - Creates CommandDefinition for each builtin skill
  - Sets category to 'skill'
  - Implements execute handler that directly uses embedded prompt
  - Checks if command already exists before registering (idempotent)
  - Calls globalRegistry.register() for each skill
- Created `createBuiltinSkillCommand()` factory function
  - Takes BuiltinSkill with embedded prompt
  - Returns CommandDefinition with execute handler
  - Uses embedded prompt directly (no disk lookup needed)
- Created `builtinSkillCommands` array
  - Maps BUILTIN_SKILLS through createBuiltinSkillCommand()
  - Exported for testing and direct access
- Updated `registerSkillCommands()` to call `registerBuiltinSkills()` first
  - Builtin skills take priority over legacy disk-based skills
  - Legacy skills only registered if not already registered

### $ARGUMENTS Expansion
- Execute handler expands $ARGUMENTS placeholder using expandArguments()
- Empty args replaced with '[no arguments provided]'
- Uses regex /\$ARGUMENTS/g for global replacement
- Passes expanded prompt to context.sendMessage()

### Tests Added
- builtinSkillCommands tests:
  - has correct number of commands
  - all commands have skill category
  - each command has matching builtin skill
  - commands use embedded prompts directly
- registerBuiltinSkills tests:
  - registers all builtin skills
  - registers builtin skill aliases
  - is idempotent
  - registered commands use embedded prompts
  - expands $ARGUMENTS in registered commands
  - replaces empty args with placeholder
- registerSkillCommands tests:
  - builtin skills take priority over legacy skills

### Test Results
- All skill-commands tests pass (108 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Added registerBuiltinSkills(), createBuiltinSkillCommand(), builtinSkillCommands
- tests/ui/commands/skill-commands.test.ts - Added builtinSkillCommands and registerBuiltinSkills tests

## 2026-02-02 - Refactor: Remove disk-based skill loading

### Completed
- Removed SKILL_SEARCH_PATHS constant (was searching .claude/commands, .opencode/command, .github/commands)
- Removed loadSkillPrompt() function that loaded skill prompts from disk
- Removed stripFrontmatter() function that stripped YAML frontmatter from markdown files
- Removed fs imports (existsSync, readFileSync) and path import (join)
- Simplified createSkillCommand() to:
  - First check for builtin skill with embedded prompt
  - Fallback to sending slash command to agent's native skill system
  - No more intermediate disk-based loading
- Updated module docstring to reflect new architecture
- Updated exports to remove loadSkillPrompt and stripFrontmatter

### Rationale
- All core skills are now defined as builtins with embedded prompts
- Disk-based skill loading was legacy fallback that's no longer needed
- Reduces file system dependencies
- Simplifies the skill command execution flow

### Test Results
- All skill-commands tests pass (108 tests)

### Files Modified
- src/ui/commands/skill-commands.ts - Removed disk-based skill loading code

## 2026-02-02 - Feature Implementation: AgentDefinition Interface

### Completed
- Created new file src/ui/commands/agent-commands.ts
- Defined AgentSource type: 'builtin' | 'project' | 'user' | 'atomic'
- Defined AgentModel type: 'sonnet' | 'opus' | 'haiku'
- Defined AgentDefinition interface with fields:
  - name: string (unique identifier, becomes slash command)
  - description: string (when to use this agent)
  - tools?: string[] (allowed tools, inherits all if omitted)
  - model?: AgentModel (model override)
  - prompt: string (system prompt content)
  - source: AgentSource (for conflict resolution)
- Added comprehensive JSDoc documentation for all types and fields
- Exported all types and interfaces

### Tests Added
- AgentDefinition interface tests:
  - valid AgentDefinition has all required fields
  - AgentDefinition supports optional tools array
  - AgentDefinition supports optional model field
  - AgentDefinition with all optional fields
  - AgentDefinition without optional fields
- AgentSource type tests (builtin, project, user, atomic)
- AgentModel type tests (sonnet, opus, haiku)
- Example agent definition tests:
  - codebase-analyzer agent definition is valid
  - codebase-locator agent definition is valid
  - debugger agent definition is valid

### Test Results
- All agent-commands tests pass (15 tests)

### Files Created
- src/ui/commands/agent-commands.ts - AgentDefinition interface and related types
- tests/ui/commands/agent-commands.test.ts - Tests for AgentDefinition interface

## 2026-02-02 - Feature Implementation: AgentFrontmatter Interface

### Completed
- Added AgentFrontmatter interface in agent-commands.ts
  - Interface handles different SDK frontmatter formats for agent markdown files
  - Added name?: string field (optional, can be derived from filename in some SDKs)
  - Added description: string field (required by all SDKs)
  - Added tools?: string[] | Record<string, boolean> field
    - Claude: array of tool names
    - OpenCode: Record<string, boolean> with tool names as keys
    - Copilot: array of tool names
  - Added model?: string field
    - Claude: "sonnet" | "opus" | "haiku"
    - OpenCode: "provider/model" format (e.g., "anthropic/claude-3-sonnet")
    - Copilot: string model identifier
  - Added mode?: "subagent" | "primary" field (OpenCode-specific)
  - Added comprehensive JSDoc documentation with examples for each SDK format
  - Exported the interface

### Tests Added
- AgentFrontmatter interface tests:
  - Claude format with tools as string array
  - OpenCode format with tools as Record<string, boolean>
  - OpenCode format with mode field
  - frontmatter with optional name field omitted
  - frontmatter with only required description field
  - Copilot format with tools as string array
  - frontmatter with all optional fields

### Test Results
- All agent-commands tests pass (22 tests)
- Note: Pre-existing test failures in builtin-commands module remain (count mismatch)

### Files Modified
- src/ui/commands/agent-commands.ts - Added AgentFrontmatter interface
- tests/ui/commands/agent-commands.test.ts - Added AgentFrontmatter tests

## 2026-02-02 - Feature Implementation: Agent Discovery Path Constants

### Completed
- Added AGENT_DISCOVERY_PATHS constant in agent-commands.ts
  - Project-local directories to search for agent definition files
  - Includes: `.claude/agents`, `.opencode/agents`, `.github/agents`, `.atomic/agents`
  - Paths are relative to project root
  - Files in these directories override user-global agents
- Added GLOBAL_AGENT_PATHS constant in agent-commands.ts
  - User-global directories to search for agent definition files
  - Includes: `~/.claude/agents`, `~/.opencode/agents`, `~/.copilot/agents`, `~/.atomic/agents`
  - Use ~ for home directory expansion
  - Project-local agents take precedence over user-global
- Exported both constants for use by discoverAgents()

### Tests Added
- AGENT_DISCOVERY_PATHS tests:
  - contains .claude/agents path
  - contains .opencode/agents path
  - contains .github/agents path
  - contains .atomic/agents path
  - has 4 project-local paths
  - all paths are relative (no leading slash or tilde)
- GLOBAL_AGENT_PATHS tests:
  - contains ~/.claude/agents path
  - contains ~/.opencode/agents path
  - contains ~/.copilot/agents path
  - contains ~/.atomic/agents path
  - has 4 user-global paths
  - all paths start with ~ for home directory expansion

### Test Results
- All agent-commands tests pass (34 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added AGENT_DISCOVERY_PATHS and GLOBAL_AGENT_PATHS constants
- tests/ui/commands/agent-commands.test.ts - Added path constant tests

## 2026-02-02 - Feature Implementation: discoverAgents() and parseAgentFrontmatter()

### Completed
- Implemented discoverAgents() function in agent-commands.ts
  - Async function returning Promise<AgentDefinition[]>
  - Scans AGENT_DISCOVERY_PATHS for project-local .md files
  - Scans GLOBAL_AGENT_PATHS for user-global .md files (with ~ expansion)
  - Parses YAML frontmatter and body content from each file
  - Uses parseAgentFrontmatter() to normalize across SDK formats
  - Determines source based on which path matched
  - Project-local agents override user-global agents with same name
  - Returns array of AgentDefinition objects

- Implemented parseAgentFrontmatter() function
  - Normalizes frontmatter from Claude, OpenCode, and Copilot formats
  - Extracts name from frontmatter.name or derives from filename
  - Extracts description with fallback default
  - Normalizes tools: converts Record<string, boolean> to string[] of enabled tools
  - Normalizes model: maps 'provider/model' format to 'sonnet'|'opus'|'haiku'
  - Returns normalized AgentDefinition

- Implemented helper functions:
  - parseMarkdownFrontmatter(): Parses YAML frontmatter from markdown content
    - Handles simple key-value pairs, arrays (Claude format), and objects (OpenCode format)
    - Returns frontmatter object and body content
  - normalizeModel(): Converts various model formats to AgentModel type
  - normalizeTools(): Converts tool formats to string array
  - expandTildePath(): Expands ~ in paths to home directory
  - determineAgentSource(): Determines agent source based on discovery path
  - discoverAgentFilesInPath(): Discovers .md files in a single directory
  - discoverAgentFiles(): Discovers all agent files from all search paths
  - parseAgentFile(): Parses a single agent file into AgentDefinition
  - shouldAgentOverride(): Determines if new agent should override existing based on source priority

- Added DiscoveredAgentFile interface for tracking discovered files with metadata

### Tests Added (49 new tests)
- parseMarkdownFrontmatter tests:
  - parses simple frontmatter with string values
  - parses frontmatter with array values (Claude format)
  - parses frontmatter with object values (OpenCode format)
  - parses frontmatter with boolean values
  - parses frontmatter with numeric values
  - returns null for content without frontmatter
  - returns null for invalid frontmatter format
  - handles empty body after frontmatter
  - handles multiline body content

- normalizeModel tests:
  - returns undefined for undefined input
  - returns direct match for sonnet/opus/haiku (case-insensitive)
  - extracts model from OpenCode format (anthropic/claude-3-*)
  - returns undefined for unknown model

- normalizeTools tests:
  - returns undefined for undefined input
  - passes through array format (Claude/Copilot)
  - converts object format to array (OpenCode)
  - returns empty array when all tools are disabled

- parseAgentFrontmatter tests:
  - creates AgentDefinition with all fields
  - uses filename as name when not in frontmatter
  - uses default description when not in frontmatter
  - normalizes OpenCode tools format
  - normalizes OpenCode model format
  - trims body content

- Path utilities tests:
  - expandTildePath: expands ~/, standalone ~, preserves absolute/relative paths
  - determineAgentSource: correctly identifies user, atomic, project sources
  - shouldAgentOverride: correct priority ordering

- discoverAgentFilesInPath tests:
  - discovers .md files in directory
  - ignores non-.md files
  - assigns correct source to discovered files
  - returns empty array for non-existent directory

- parseAgentFile tests:
  - parses agent with full frontmatter
  - parses agent without frontmatter
  - returns null for non-existent file

- discoverAgents tests:
  - discovers agents from local directories
  - returns array of AgentDefinition objects

### Test Results
- All agent-commands tests pass (83 tests)
- Note: Pre-existing test failures in builtin-commands and tool-result modules remain

### Files Modified
- src/ui/commands/agent-commands.ts - Added imports, interfaces, and all implementation functions
- tests/ui/commands/agent-commands.test.ts - Added comprehensive tests for all new functions

## 2026-02-02 - Feature Implementation: BUILTIN_AGENTS with codebase-analyzer

### Completed
- Created BUILTIN_AGENTS array in agent-commands.ts
  - Array of AgentDefinition objects for always-available agents
  - Agents can be overridden by project-local or user-global agents

- Added codebase-analyzer builtin agent:
  - name: 'codebase-analyzer'
  - description: 'Analyzes codebase implementation details. Call when you need to find detailed information about specific components.'
  - tools: ['Glob', 'Grep', 'NotebookRead', 'Read', 'LS', 'Bash']
  - model: 'opus' (highest capability for thorough analysis)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Capabilities section listing all available tools
    - 7-step analysis process (Understand Request, Gather Context, Analyze Structure, Trace Data Flow, Identify Patterns, Document Dependencies, Provide Insights)
    - Output format guidelines (Overview, Architecture, Key Components, Data Flow, Dependencies, Patterns, Notable Details)
    - Best practices and guidelines

- Implemented getBuiltinAgent() helper function:
  - Looks up builtin agent by name
  - Case-insensitive matching
  - Returns AgentDefinition or undefined

### Tests Added (18 new tests)
- BUILTIN_AGENTS array tests:
  - is an array
  - contains at least one agent
  - all agents have required fields
  - all agents have unique names
  - contains codebase-analyzer agent

- codebase-analyzer builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with analysis tools
  - has opus model
  - has comprehensive system prompt
  - prompt includes analysis process steps
  - prompt includes output format guidelines
  - has builtin source

- getBuiltinAgent tests:
  - finds agent by exact name
  - finds agent case-insensitively
  - returns undefined for non-existent agent
  - returns undefined for empty string

### Test Results
- All agent-commands tests pass (101 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added BUILTIN_AGENTS array and getBuiltinAgent() function
- tests/ui/commands/agent-commands.test.ts - Added BUILTIN_AGENTS and getBuiltinAgent tests

## 2026-02-02 - Feature Implementation: codebase-locator Builtin Agent

### Completed
- Added codebase-locator agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'codebase-locator'
  - description: 'Locates files, directories, and components relevant to a feature or task. A Super Grep/Glob/LS tool.'
  - tools: ['Glob', 'Grep', 'NotebookRead', 'Read', 'LS', 'Bash']
  - model: 'haiku' (optimized for speed)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Navigation Strategy section covering:
      - Understand the Target
      - Quick Pattern Matching
      - Content Search
      - Directory Exploration
      - Verification
    - Common file patterns for components, services, utils, tests, config
    - Output format guidelines (Primary Matches, Related Files, Directory Structure)
    - Guidelines for efficient searching

### Tests Added (13 new tests)
- codebase-locator builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with navigation tools
  - has haiku model for speed
  - has comprehensive system prompt
  - prompt includes navigation strategy steps
  - prompt includes common file patterns
  - prompt includes output format guidelines
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains codebase-locator agent
- getBuiltinAgent tests:
  - finds codebase-locator by name
  - finds codebase-locator case-insensitively

### Test Results
- All agent-commands tests pass (114 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added codebase-locator to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added codebase-locator tests

## 2026-02-02 - Feature Implementation: codebase-pattern-finder Builtin Agent

### Completed
- Added codebase-pattern-finder agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'codebase-pattern-finder'
  - description: 'Finds similar implementations, usage examples, or existing patterns that can be modeled after.'
  - tools: ['Glob', 'Grep', 'NotebookRead', 'Read', 'LS', 'Bash']
  - model: 'sonnet' (balanced performance for thorough pattern analysis)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Pattern Finding Strategy section covering:
      - Understand the Request
      - Search for Similar Structures
      - Identify Code Patterns
      - Analyze Found Examples
      - Extract Actionable Insights
    - Pattern categories (Structural, Naming, Implementation, API, Error Handling, Testing)
    - Output format guidelines (Pattern Summary, Best Examples, Implementation Details, Usage Guidelines, Variations, Related Patterns)
    - Guidelines for finding concrete, working examples

### Tests Added (13 new tests)
- codebase-pattern-finder builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with pattern finding tools
  - has sonnet model
  - has comprehensive system prompt
  - prompt includes pattern finding strategy steps
  - prompt includes pattern categories
  - prompt includes output format guidelines
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains codebase-pattern-finder agent
- getBuiltinAgent tests:
  - finds codebase-pattern-finder by name
  - finds codebase-pattern-finder case-insensitively

### Test Results
- All agent-commands tests pass (127 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added codebase-pattern-finder to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added codebase-pattern-finder tests

## 2026-02-02 - Feature Implementation: codebase-online-researcher Builtin Agent

### Completed
- Added codebase-online-researcher agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'codebase-online-researcher'
  - description: 'Researches questions using web sources for modern, online-only information.'
  - tools: ['Glob', 'Grep', 'Read', 'LS', 'WebFetch', 'WebSearch', 'mcp__deepwiki__ask_question']
  - model: 'sonnet' (balanced performance for thorough research)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Research Strategy section covering:
      - Understand the Research Goal
      - Check Local Context First
      - Search the Web
      - Fetch Specific Resources
      - Query Repository Documentation
    - Output format guidelines (Summary, Key Findings, Sources, Code Examples, Recommendations, Caveats)
    - Guidelines for verifying information across multiple sources
    - Integration with DeepWiki for GitHub repository documentation

### Tests Added (13 new tests)
- codebase-online-researcher builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with web research tools
  - has sonnet model
  - has comprehensive system prompt
  - prompt includes research strategy steps
  - prompt includes output format guidelines
  - prompt mentions DeepWiki tool
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains codebase-online-researcher agent
- getBuiltinAgent tests:
  - finds codebase-online-researcher by name
  - finds codebase-online-researcher case-insensitively

### Test Results
- All agent-commands tests pass (140 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added codebase-online-researcher to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added codebase-online-researcher tests

## 2026-02-02 - Feature Implementation: codebase-research-analyzer Builtin Agent

### Completed
- Added codebase-research-analyzer agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'codebase-research-analyzer'
  - description: 'Deep dive on research topics in the research/ directory.'
  - tools: ['Read', 'Grep', 'Glob', 'LS', 'Bash']
  - model: 'sonnet' (balanced performance for thorough research analysis)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Research Analysis Strategy section covering:
      - Survey the Research Landscape
      - Understand the Context
      - Deep Dive Analysis
      - Extract Insights
      - Synthesize Knowledge
    - Document Types section explaining:
      - research/progress.txt
      - research/feature-list.json
      - research/spec.md
      - research/architecture.md
      - research/patterns.md
      - research/data-models.md
    - Output format guidelines (Research Overview, Key Findings, Current State, Gaps Identified, Recommendations, Cross-References, Open Questions)
    - Guidelines for thorough, citation-based analysis

### Tests Added (13 new tests)
- codebase-research-analyzer builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with research analysis tools
  - has sonnet model
  - has comprehensive system prompt
  - prompt includes research analysis strategy steps
  - prompt includes document types
  - prompt includes output format guidelines
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains codebase-research-analyzer agent
- getBuiltinAgent tests:
  - finds codebase-research-analyzer by name
  - finds codebase-research-analyzer case-insensitively

### Test Results
- All agent-commands tests pass (153 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added codebase-research-analyzer to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added codebase-research-analyzer tests

## 2026-02-02 - Feature Implementation: codebase-research-locator Builtin Agent

### Completed
- Added codebase-research-locator agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'codebase-research-locator'
  - description: 'Discovers relevant documents in research/ directory for metadata storage.'
  - tools: ['Read', 'Grep', 'Glob', 'LS', 'Bash']
  - model: 'haiku' (optimized for speed)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Document Discovery Strategy section covering:
      - Understand the Search Goal
      - Quick Directory Survey
      - Pattern-Based Search
      - Content Verification
      - Provide Targeted Results
    - Common Research Document Types explaining:
      - research/progress.txt
      - research/feature-list.json
      - research/spec.md
      - research/architecture.md
      - research/patterns.md
      - research/data-models.md
      - research/dependencies.md
      - research/entry-points.md
      - research/tech-stack.md
    - Output format guidelines (Primary Matches, Related Documents, Document Structure)
    - Guidelines for fast, efficient research document discovery

### Tests Added (13 new tests)
- codebase-research-locator builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with research locator tools
  - has haiku model for speed
  - has comprehensive system prompt
  - prompt includes document discovery strategy steps
  - prompt includes common research document types
  - prompt includes output format guidelines
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains codebase-research-locator agent
- getBuiltinAgent tests:
  - finds codebase-research-locator by name
  - finds codebase-research-locator case-insensitively

### Test Results
- All agent-commands tests pass (166 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added codebase-research-locator to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added codebase-research-locator tests

## 2026-02-02 - Feature Implementation: debugger Builtin Agent

### Completed
- Added debugger agent to BUILTIN_AGENTS array in agent-commands.ts
  - name: 'debugger'
  - description: 'Debugging specialist for errors, test failures, and unexpected behavior.'
  - tools: ['Bash', 'Task', 'AskUserQuestion', 'Edit', 'Glob', 'Grep', 'Read', 'Write', 'WebFetch', 'WebSearch']
  - model: 'sonnet' (balanced performance for systematic debugging)
  - source: 'builtin'
  - Comprehensive system prompt including:
    - Debugging Process section (8 steps):
      - Understand the Problem
      - Reproduce the Issue
      - Gather Evidence
      - Form Hypotheses
      - Test Hypotheses
      - Implement Fix
      - Verify Fix
      - Document Findings
    - Debug Report Format template with sections:
      - Error Summary
      - Error Details (Type, Location, Error Message)
      - Root Cause
      - Investigation Steps
      - Fix Applied
      - Verification
      - Recommendations
    - Common Debugging Patterns section:
      - Test Failures
      - Runtime Errors
      - Type Errors
      - Build/Compile Errors
    - Guidelines for systematic debugging approach

### Tests Added (13 new tests)
- debugger builtin agent tests:
  - exists in BUILTIN_AGENTS
  - has correct name
  - has appropriate description
  - has tools array with debugging tools
  - has sonnet model
  - has comprehensive system prompt
  - prompt includes debugging process steps
  - prompt includes debug report format
  - prompt includes common debugging patterns
  - has builtin source
- BUILTIN_AGENTS array tests:
  - contains debugger agent
- getBuiltinAgent tests:
  - finds debugger by name
  - finds debugger case-insensitively

### Test Results
- All agent-commands tests pass (179 tests)

### Files Modified
- src/ui/commands/agent-commands.ts - Added debugger to BUILTIN_AGENTS array
- tests/ui/commands/agent-commands.test.ts - Added debugger tests

## 2026-02-02 - Feature Implementation: registerAgentCommands() Function

### Completed
- Added 'agent' to CommandCategory type in registry.ts
  - Updated type definition to include: "builtin" | "workflow" | "skill" | "agent" | "custom"
  - Updated categoryPriority sort order: workflow > skill > agent > builtin > custom

- Implemented createAgentCommand() function in agent-commands.ts
  - Takes AgentDefinition and returns CommandDefinition
  - Sets category to 'agent'
  - Sets hidden to false
  - Execute handler sends agent prompt via context.sendMessage()
  - Appends user arguments with "## User Request" section

- Created builtinAgentCommands array
  - Maps BUILTIN_AGENTS through createAgentCommand()
  - Exported for testing and direct access

- Implemented registerBuiltinAgents() function
  - Iterates over builtinAgentCommands
  - Checks if command exists before registering (idempotent)
  - Registers each agent with globalRegistry

- Implemented registerAgentCommands() async function
  - First calls registerBuiltinAgents() to register builtins
  - Then calls discoverAgents() to find disk-based agents
  - Handles source priority (project > atomic > user > builtin)
  - Registers discovered agents that don't conflict with builtins

### Tests Added (19 new tests)
- createAgentCommand tests:
  - creates CommandDefinition from AgentDefinition
  - creates CommandDefinition for agent with all fields
  - execute handler calls sendMessage with agent prompt
  - execute handler appends user args to prompt
  - execute handler trims user args

- builtinAgentCommands tests:
  - is an array
  - has same length as BUILTIN_AGENTS
  - all commands have agent category
  - all commands have execute function
  - each command corresponds to a builtin agent
  - includes codebase-analyzer command
  - includes debugger command

- registerBuiltinAgents tests:
  - registers all builtin agents
  - registered commands have agent category
  - is idempotent
  - registered commands can be executed

- registerAgentCommands tests:
  - registers all builtin agents
  - discovers and registers custom agents from disk
  - is idempotent

### Test Results
- All agent-commands tests pass (198 tests)
- All registry tests pass (35 tests)

### Files Modified
- src/ui/commands/registry.ts - Added 'agent' to CommandCategory type and priority
- src/ui/commands/agent-commands.ts - Added imports, createAgentCommand(), builtinAgentCommands, registerBuiltinAgents(), registerAgentCommands()
- tests/ui/commands/agent-commands.test.ts - Added registration tests

## 2026-02-02 - Feature Implementation: Configure SDK Permission Bypass

### Overview
Implemented permission bypass configuration for all three SDK clients (Claude, OpenCode, Copilot) to allow all tools to auto-execute without prompts.

### Claude SDK Changes
- Added "bypass" option to PermissionMode type in types.ts
- Updated buildSdkOptions() in claude-client.ts to handle bypass mode:
  - Maps "bypass" to SDK's "bypassPermissions"
  - Sets `allowDangerouslySkipPermissions: true` when bypass mode is used
- Added comprehensive documentation comment explaining permission modes
- Note: AskUserQuestion tool still pauses for human input via canUseTool callback

### OpenCode SDK Changes
- OpenCode permissions are configured via opencode.json files, not SDK options
- Added comprehensive documentation in module docstring explaining:
  - How to create opencode.json with `"permission": "allow"` for full bypass
  - Config file locations (project root, global ~/.config/opencode/, OPENCODE_CONFIG env)
  - Non-interactive/CLI mode auto-approves by default
- question.asked events still emitted for user-initiated questions

### Copilot SDK Changes
- Copilot already auto-approves all operations via createHITLPermissionHandler()
- Updated documentation to clarify this is bypass mode behavior
- Added detailed JSDoc explaining how to implement custom permission handling
- setPermissionHandler() can be used for custom HITL approval flows

### Tests Added
- Claude client tests:
  - bypass permission mode sets bypassPermissions and allowDangerouslySkipPermissions
  - bypass mode still allows AskUserQuestion HITL via canUseTool

### Test Results
- All claude-client tests pass (30 tests)
- All types tests pass (29 tests)

### Files Modified
- src/sdk/types.ts - Added "bypass" to PermissionMode type with documentation
- src/sdk/claude-client.ts - Updated buildSdkOptions() for bypass mode
- src/sdk/opencode-client.ts - Added permission documentation in module docstring
- src/sdk/copilot-client.ts - Updated documentation for bypass behavior
- tests/sdk/claude-client.test.ts - Added bypass mode tests

## 2026-02-02 - Feature Implementation: AskUserQuestion HITL Integration Tests

### Overview
Created comprehensive integration tests to verify that the AskUserQuestion tool
correctly pauses agent execution and emits permission.requested events across
all SDK clients, even when using bypass permission mode.

### Tests Added
- tests/sdk/ask-user-question-hitl.test.ts with 8 tests:
  - permission.requested event is emitted when AskUserQuestion tool is called
  - AskUserQuestion works in default permission mode
  - AskUserQuestion works in auto permission mode
  - multiSelect option is correctly passed through
  - non-AskUserQuestion tools auto-approve in bypass mode
  - respond callback resolves with user answer
  - empty questions array defaults to yes/no options
  - permission.requested event has correct structure

### Key Verifications
- AskUserQuestion tool emits permission.requested event regardless of permission mode
- Event includes: requestId, toolName, question, header, options, multiSelect, respond callback
- respond callback correctly collects user answer and allows execution to continue
- Non-AskUserQuestion tools auto-approve in bypass mode without emitting events
- Event structure matches PermissionRequestedEventData interface

### Test Results
- All 8 tests pass
- 48 expect() calls

### Files Created
- tests/sdk/ask-user-question-hitl.test.ts - Comprehensive HITL integration tests

## 2026-02-02 - Feature Implementation: RalphSession and RalphFeature interfaces

### Overview
Created src/workflows/ralph-session.ts with core interfaces and helper functions
for Ralph loop session management.

### Interfaces Created

#### RalphFeature Interface
- id: string - Unique identifier
- name: string - Short descriptive name
- description: string - Detailed description
- acceptanceCriteria?: string[] - List of acceptance criteria
- status: 'pending' | 'in_progress' | 'passing' | 'failing'
- implementedAt?: string - ISO timestamp when implemented
- error?: string - Error message if failing

#### RalphSession Interface
- sessionId: string - UUID v4 identifier
- sessionDir: string - Path to .ralph/sessions/{sessionId}/
- createdAt: string - ISO timestamp
- lastUpdated: string - ISO timestamp
- yolo: boolean - True = no feature list (autonomous exploration)
- maxIterations: number - Max iterations before stopping
- sourceFeatureListPath?: string - Path to source feature-list.json
- features: RalphFeature[] - List of features to implement
- currentFeatureIndex: number - Index of current feature
- completedFeatures: string[] - List of completed feature IDs
- iteration: number - Current iteration number
- status: 'running' | 'paused' | 'completed' | 'failed'
- prUrl?: string - Pull request URL
- prBranch?: string - Git branch name

### Helper Functions
- generateSessionId(): string - Generates UUID v4 session ID
- getSessionDir(sessionId): string - Returns session directory path
- createRalphSession(options): RalphSession - Creates new session with defaults
- createRalphFeature(options): RalphFeature - Creates new feature with defaults
- isRalphSession(value): boolean - Type guard for RalphSession
- isRalphFeature(value): boolean - Type guard for RalphFeature

### Tests Created
- tests/workflows/ralph-session.test.ts with 31 tests:
  - RalphFeature creation and validation tests
  - RalphSession creation and validation tests
  - generateSessionId() UUID generation tests
  - getSessionDir() path generation tests
  - Type guard validation tests
  - Integration workflow simulation test

### Test Results
- All 31 tests pass
- 87 expect() calls

### Files Created/Modified
- src/workflows/ralph-session.ts - New file with interfaces and helpers
- src/workflows/index.ts - Updated to export ralph-session module
- tests/workflows/ralph-session.test.ts - New test file

## 2026-02-02 - Feature Implementation: Session File System Operations

### Overview
Added file system operations for Ralph session persistence to ralph-session.ts.

### Functions Implemented

#### createSessionDirectory(sessionId)
- Creates .ralph/sessions/{sessionId}/ directory structure
- Creates subdirectories: checkpoints/, research/, logs/
- Uses fs.mkdir with recursive: true for idempotent creation
- Returns the session directory path

#### saveSession(sessionDir, session)
- Saves RalphSession to {sessionDir}/session.json
- Updates lastUpdated timestamp before saving
- Uses JSON.stringify with 2-space indentation

#### loadSession(sessionDir)
- Loads RalphSession from {sessionDir}/session.json
- Validates loaded data with isRalphSession type guard
- Throws error if file doesn't exist or data is invalid

#### loadSessionIfExists(sessionDir)
- Safe wrapper around loadSession
- Returns RalphSession if exists, null otherwise
- Catches all errors (file not found, invalid JSON, etc.)

#### appendLog(sessionDir, logName, entry)
- Appends log entry to {sessionDir}/logs/{logName}.jsonl
- Uses NDJSON format (newline-delimited JSON)
- Automatically adds timestamp to each entry

### Constants Added
- SESSION_SUBDIRECTORIES: ["checkpoints", "research", "logs"]

### Tests Added
- 11 new tests for file system operations:
  - createSessionDirectory creates all subdirectories
  - createSessionDirectory is idempotent
  - saveSession and loadSession roundtrip
  - loadSession throws for non-existent/invalid data
  - loadSessionIfExists returns session or null
  - appendLog creates files and appends entries
  - appendLog adds timestamps automatically

### Test Results
- All 42 tests pass (31 original + 11 new)
- 119 expect() calls

### Files Modified
- src/workflows/ralph-session.ts - Added fs imports and file operations
- src/workflows/index.ts - Added exports for new functions
- tests/workflows/ralph-session.test.ts - Added file system tests

## 2026-02-02 - Feature Implementation: appendProgress() Function

### Completed
- Implemented appendProgress() function in ralph-session.ts
  - Takes sessionDir, feature (RalphFeature), and passed (boolean) parameters
  - Returns Promise<void>
  - Constructs status emoji:  for passing,  for failing
  - Formats progress line: [{ISO timestamp}] {status emoji} {feature.name}
  - Appends to {sessionDir}/progress.txt
  - Uses fs.appendFile for atomic append operation
  - Creates progress.txt if it doesn't exist

### Tests Added
- 5 new tests for appendProgress:
  - creates progress.txt and appends passing entry with checkmark
  - appends failing entry with X mark
  - appends multiple entries in order
  - timestamp is in ISO format
  - creates progress.txt file if it doesn't exist

### Test Results
- All 47 tests pass (42 original + 5 new)
- 137 expect() calls

### Files Modified
- src/workflows/ralph-session.ts - Added appendProgress() function
- src/workflows/index.ts - Added appendProgress export
- tests/workflows/ralph-session.test.ts - Added appendProgress tests

## 2026-02-02 - Feature Implementation: Create src/graph/nodes/ralph-nodes.ts file

### Completed
- Created src/graph/nodes/ralph-nodes.ts file with:
  - RalphWorkflowState interface extending BaseState:
    - BaseState fields: executionId, lastUpdated, outputs
    - Ralph session identity: ralphSessionId, ralphSessionDir
    - Session configuration: yolo, maxIterations, sourceFeatureListPath, userPrompt
    - Feature tracking: features, currentFeatureIndex, completedFeatures, currentFeature
    - Execution tracking: iteration, sessionStatus
    - Control flow flags: shouldContinue, allFeaturesPassing, maxIterationsReached, yoloComplete
    - PR artifacts: prUrl, prBranch
    - Context tracking: contextWindowUsage
  - isRalphWorkflowState() type guard function
  - CreateRalphStateOptions interface for factory configuration
  - createRalphWorkflowState() factory function with default values
  - sessionToWorkflowState() to convert RalphSession to RalphWorkflowState
  - workflowStateToSession() to convert RalphWorkflowState to RalphSession
  - Re-exports of all ralph-session.ts types and functions for convenience

### Tests Added (48 tests)
- RalphWorkflowState tests:
  - createRalphWorkflowState creates default state with all required fields
  - Accepts custom session ID, execution ID, yolo mode, max iterations
  - Accepts unlimited iterations (0)
  - Accepts source feature list path and initial features
  - Generates unique session and execution IDs
- isRalphWorkflowState tests:
  - Returns true for valid state and factory-created state
  - Returns false for null, undefined, non-object, empty object
  - Returns false for missing required fields
  - Returns false for invalid sessionStatus or non-boolean yolo
- State conversion tests:
  - sessionToWorkflowState converts correctly
  - Generates new execution ID and accepts custom
  - Sets shouldContinue based on session status
  - Calculates allFeaturesPassing from features
  - Calculates maxIterationsReached from session
  - Sets currentFeature from features array
  - workflowStateToSession converts correctly
  - Updates lastUpdated timestamp
  - Round-trip conversions preserve data
- Re-exported function tests (all ralph-session.ts functions work)
- File system re-export tests (createSessionDirectory, save/load, appendLog, appendProgress)
- Integration tests:
  - Full workflow: create state -> save session -> resume
  - Yolo mode workflow

### Test Results
- All 48 tests pass
- 149 expect() calls

### Files Created
- src/graph/nodes/ralph-nodes.ts - RalphWorkflowState interface and factory functions
- tests/graph/nodes/ralph-nodes.test.ts - Comprehensive tests

## 2026-02-02 - Feature Implementation: initRalphSessionNode() Function

### Completed
- Implemented initRalphSessionNode() factory function in ralph-nodes.ts
  - Returns NodeDefinition with type 'tool'
  - Accepts InitRalphSessionNodeConfig with options:
    - id: string (required)
    - name?: string (default: "init-ralph-session")
    - description?: string
    - featureListPath?: string (default: "research/feature-list.json")
    - yolo?: boolean (default: false)
    - resumeSessionId?: string (for resuming existing sessions)
    - maxIterations?: number (default: 50)
    - userPrompt?: string (for yolo mode)

- Execute function handles three scenarios:
  1. Resume existing session (if resumeSessionId provided and session exists)
  2. Create new session with feature list (if not yolo mode)
  3. Create new session in yolo mode (no features loaded)

- Session initialization includes:
  - Creating session directory structure (.ralph/sessions/{sessionId}/)
  - Loading features from feature-list.json (converts to RalphFeature format)
  - Creating progress.txt with session header
  - Saving session.json for persistence
  - Copying features to session's research/feature-list.json
  - Logging init/resume actions to agent-calls.jsonl

- Helper functions added:
  - loadFeaturesFromFile(): Loads and converts feature-list.json to RalphFeature[]
  - initializeProgressFile(): Creates progress.txt with session header
  - saveSessionFeatureList(): Copies features to session directory
  - FeatureListJson interface: Type for feature-list.json structure

### Tests Added (18 new tests)
- Node creation tests:
  - creates NodeDefinition with correct properties
  - accepts custom name and description

- New session creation tests:
  - creates session with generated ID
  - creates session directory structure
  - loads features from feature list file
  - creates progress.txt with session header
  - saves session.json file
  - logs init action to agent-calls.jsonl
  - copies features to session research directory
  - uses custom maxIterations
  - throws error for non-existent feature list

- Yolo mode tests:
  - creates session without loading features
  - creates progress.txt with yolo mode header
  - logs yolo flag in agent-calls.jsonl
  - does not create feature-list.json in research directory

- Session resumption tests:
  - resumes existing session from disk
  - logs resume action to agent-calls.jsonl
  - creates new session if resume ID not found

### Test Results
- All 66 tests pass (48 original + 18 new)
- 204 expect() calls

### Files Modified
- src/graph/nodes/ralph-nodes.ts - Added initRalphSessionNode() and helper functions
- tests/graph/nodes/ralph-nodes.test.ts - Added initRalphSessionNode tests

## 2026-02-02 - Feature Implementation: implementFeatureNode() for Feature-List Mode

### Completed
- Implemented implementFeatureNode() factory function in ralph-nodes.ts
  - Returns NodeDefinition with type 'tool'
  - Accepts ImplementFeatureNodeConfig with options:
    - id: string (required)
    - name?: string (default: "implement-feature")
    - description?: string
    - promptTemplate?: string (supports {{id}}, {{name}}, {{description}}, {{acceptanceCriteria}} placeholders)

- Execute function handles:
  1. Finds next feature with status 'pending'
  2. If no pending features:
     - Checks if all features are 'passing'
     - Sets allFeaturesPassing flag
     - Sets shouldContinue: false if all pass, true if some failing
     - Logs completion check to agent-calls.jsonl
  3. If pending feature found:
     - Marks feature as 'in_progress'
     - Updates currentFeatureIndex and currentFeature
     - Saves session to session.json
     - Updates session's feature-list.json
     - Logs agent call start
     - Builds prompt from template if provided

- Implemented processFeatureImplementationResult() helper function:
  - Processes results after agent execution
  - Updates feature status to 'passing' or 'failing'
  - Sets implementedAt timestamp if passing
  - Adds to completedFeatures if passing
  - Increments iteration
  - Checks maxIterations reached
  - Saves session and updates feature-list.json
  - Appends to progress.txt
  - Logs result to agent-calls.jsonl

### Tests Added (24 new tests)
- implementFeatureNode tests:
  - Node creation (2 tests)
  - Finding pending features (3 tests)
  - No pending features handling (3 tests)
  - Prompt template (2 tests)
  - Session persistence (3 tests)

- processFeatureImplementationResult tests:
  - Updates feature to passing/failing status (2 tests)
  - Adds/doesn't add to completedFeatures (2 tests)
  - Increments iteration (1 test)
  - Detects max iterations reached (1 test)
  - Clears currentFeature (1 test)
  - Returns empty if no current feature (1 test)
  - Saves session to disk (1 test)
  - Appends to progress.txt (1 test)
  - Logs result (1 test)

### Test Results
- All 90 tests pass (66 original + 24 new)
- 253 expect() calls

### Files Modified
- src/graph/nodes/ralph-nodes.ts - Added implementFeatureNode(), processFeatureImplementationResult(), and types
- tests/graph/nodes/ralph-nodes.test.ts - Added implementFeatureNode and processFeatureImplementationResult tests

## 2026-02-02 - Feature Implementation: Yolo Mode for implementFeatureNode()

### Completed
- Implemented yolo mode support in implementFeatureNode() in ralph-nodes.ts
  - Added check for state.yolo at the start of execute function
  - If yolo mode, gets userPrompt from config.prompt or state.userPrompt
  - Throws error "Yolo mode requires a prompt" if no prompt provided
  - Config prompt takes precedence over state prompt

- Added YOLO_COMPLETION_INSTRUCTION constant
  - Contains EXTREMELY_IMPORTANT tag to ensure agent notices it
  - Instructions for agent to output "COMPLETE" when task is finished
  - Guidance to only output COMPLETE when genuinely done

- Added checkYoloCompletion() helper function
  - Uses regex /\bCOMPLETE\b/ to match standalone COMPLETE word
  - Returns true if output contains COMPLETE
  - Returns false for partial matches like "COMPLETED"

- Implemented processYoloResult() function
  - Processes agent output in yolo mode
  - Checks for COMPLETE signal using checkYoloCompletion()
  - Increments iteration counter
  - Checks for max iterations reached (0 = unlimited)
  - Sets yoloComplete flag based on COMPLETE detection
  - Sets sessionStatus to "completed" when done
  - Saves session to disk
  - Appends progress to progress.txt with checkmark/X
  - Logs yolo-result action to agent-calls.jsonl
  - Logs completion message when complete or max iterations reached

- Updated ImplementFeatureNodeConfig interface
  - Added prompt?: string field for yolo mode prompt override

### Tests Added (30 new tests)
- YOLO_COMPLETION_INSTRUCTION tests:
  - Contains EXTREMELY_IMPORTANT tag
  - Contains COMPLETE instruction
  - Instructs to only output COMPLETE when truly finished

- checkYoloCompletion tests:
  - Returns true when output contains COMPLETE
  - Returns true when COMPLETE is on its own line
  - Returns false when output does not contain COMPLETE
  - Returns false for partial match (COMPLETED)
  - Returns false for lowercase complete
  - Returns true when COMPLETE appears in middle of text

- implementFeatureNode yolo mode tests:
  - Throws error when yolo mode has no prompt
  - Uses userPrompt from state in yolo mode
  - Uses prompt from config in yolo mode
  - Config prompt takes precedence over state prompt
  - Appends COMPLETION_INSTRUCTION to prompt
  - Sets yolo flag in outputs
  - Sets shouldContinue to true
  - Sets yoloComplete to false initially
  - Logs yolo action to agent-calls.jsonl

- processYoloResult tests:
  - Sets yoloComplete to true when output contains COMPLETE
  - Sets yoloComplete to false when not complete
  - Sets shouldContinue to false when COMPLETE detected
  - Sets shouldContinue to true when not complete
  - Increments iteration
  - Detects max iterations reached
  - Unlimited iterations when maxIterations is 0
  - Sets sessionStatus to completed when COMPLETE detected
  - Saves session to disk
  - Appends to progress.txt (checkmark for complete, X for not)
  - Logs yolo-result to agent-calls.jsonl

### Test Results
- All 120 tests pass (90 original + 30 new)
- 296 expect() calls

### Files Modified
- src/graph/nodes/ralph-nodes.ts - Added yolo mode support, YOLO_COMPLETION_INSTRUCTION, checkYoloCompletion(), processYoloResult()
- tests/graph/nodes/ralph-nodes.test.ts - Added comprehensive yolo mode tests

## 2026-02-02 - Feature Implementation: checkCompletionNode() for Determining Loop Exit

### Completed
- Implemented checkCompletionNode() factory function in ralph-nodes.ts
  - Returns NodeDefinition with type 'tool'
  - Accepts CheckCompletionNodeConfig with options:
    - id: string (required)
    - name?: string (default: "check-completion")
    - description?: string

- Yolo mode completion check:
  - Checks if yoloComplete flag is true
  - Checks if sessionStatus is already 'completed'
  - Logs 'Task completed! Agent signaled COMPLETE.' when complete
  - Logs max iterations message when limit reached
  - Updates sessionStatus to 'completed' when done
  - Saves session to disk when completing

- Feature-list mode completion check:
  - Checks if all features have status 'passing'
  - Checks for pending and failing features
  - Logs 'All features passing! Workflow complete.' when done
  - Logs 'Max iterations (N) reached.' with features completed count
  - Updates sessionStatus to 'completed' when done
  - Saves session to disk when completing

- Max iterations handling:
  - maxIterations > 0: Stops when iteration >= maxIterations
  - maxIterations = 0: Unlimited iterations
  - Sets maxIterationsReached flag appropriately

- Control flow flags returned:
  - shouldContinue: Whether the workflow loop should continue
  - allFeaturesPassing: Whether all features are passing (feature-list mode)
  - yoloComplete: Whether yolo mode task is complete
  - maxIterationsReached: Whether max iterations limit was hit
  - sessionStatus: Updated session status ('running' or 'completed')

### Tests Added (22 new tests)
- Node creation tests:
  - Creates a NodeDefinition with correct properties
  - Accepts custom name and description

- Yolo mode completion check tests:
  - Sets shouldContinue to false when yoloComplete is true
  - Sets shouldContinue to false when sessionStatus is completed
  - Sets shouldContinue to true when not complete in yolo mode
  - Sets shouldContinue to false when max iterations reached in yolo mode
  - Updates sessionStatus to completed when done in yolo mode
  - Logs check-completion action in yolo mode
  - Saves session when completing in yolo mode

- Feature-list mode completion check tests:
  - Sets allFeaturesPassing to true when all features are passing
  - Sets shouldContinue to true when some features are pending
  - Sets shouldContinue to true when some features are failing
  - Sets shouldContinue to false when max iterations reached
  - Updates sessionStatus to completed when all features passing
  - Updates sessionStatus to completed when max iterations reached
  - Logs check-completion action in feature-list mode
  - Saves session when completing in feature-list mode
  - Does not save session when continuing in feature-list mode

- Unlimited iterations tests:
  - maxIterations 0 means unlimited in yolo mode
  - maxIterations 0 means unlimited in feature-list mode

- Edge cases tests:
  - Handles empty features array in feature-list mode
  - Handles mixed feature statuses correctly

### Test Results
- All 142 tests pass (120 original + 22 new)
- 342 expect() calls

### Files Modified
- src/graph/nodes/ralph-nodes.ts - Added CheckCompletionNodeConfig interface and checkCompletionNode() function
- tests/graph/nodes/ralph-nodes.test.ts - Added comprehensive checkCompletionNode tests

## 2026-02-02 - Feature Implementation: createPRNode() for Creating PR with Session Metadata

### Completed
- Implemented createPRNode() factory function in ralph-nodes.ts
  - Returns NodeDefinition with type 'tool'
  - Accepts CreatePRNodeConfig with options:
    - id: string (required)
    - name?: string (default: "create-pr")
    - description?: string
    - baseBranch?: string (default: "main")
    - titleTemplate?: string (supports $SESSION_ID, $FEATURE_COUNT placeholders)
    - promptTemplate?: string (overrides default CREATE_PR_PROMPT)

- Added CREATE_PR_PROMPT constant:
  - Contains instructions for agent to create PR
  - Supports placeholders: $SESSION_ID, $COMPLETED_FEATURES, $TOTAL_FEATURES, $PASSING_FEATURES, $BASE_BRANCH
  - Includes gh CLI instructions for PR creation
  - Instructs agent to output PR_URL on its own line

- Helper functions for PR result processing:
  - extractPRUrl(output): Extracts PR URL from agent output
    - Looks for PR_URL: marker first
    - Falls back to GitHub PR URL pattern
  - extractBranchName(output): Extracts branch name from output

- processCreatePRResult() helper function:
  - Extracts PR URL and branch from agent output
  - Updates session status to 'completed'
  - Sets shouldContinue to false
  - Saves session to disk
  - Appends final completion to progress.txt
  - Logs create-pr-result action

### Tests Added (32 new tests)
- CREATE_PR_PROMPT tests:
  - Contains session ID placeholder
  - Contains completed features placeholder
  - Contains base branch placeholder
  - Contains gh CLI instructions
  - Contains PR_URL output format instruction

- extractPRUrl tests:
  - Extracts PR URL from PR_URL: marker
  - Extracts PR URL from GitHub PR pattern
  - Prefers PR_URL marker over raw URL
  - Returns undefined when no PR URL found
  - Handles multiline output

- extractBranchName tests:
  - Extracts branch name from output
  - Extracts branch name with quotes
  - Returns undefined when no branch found

- Node creation tests:
  - Creates a NodeDefinition with correct properties
  - Accepts custom name and description
  - Accepts custom base branch

- Execute function tests:
  - Builds prompt with session ID
  - Builds prompt with completed features
  - Builds prompt with base branch
  - Builds prompt with feature counts
  - Stores title in outputs when titleTemplate provided
  - Logs create-pr-start action
  - Uses custom prompt template

- processCreatePRResult tests:
  - Extracts PR URL from agent output
  - Sets sessionStatus to completed
  - Sets shouldContinue to false
  - Saves session to disk
  - Appends to progress.txt
  - Logs create-pr-result action
  - Handles output without PR URL
  - Marks progress as failing when no PR URL
  - Extracts branch name when present

### Test Results
- All 174 tests pass (142 original + 32 new)
- 393 expect() calls

### Files Modified
- src/graph/nodes/ralph-nodes.ts - Added CREATE_PR_PROMPT, CreatePRNodeConfig, createPRNode(), extractPRUrl(), extractBranchName(), processCreatePRResult()
- tests/graph/nodes/ralph-nodes.test.ts - Added comprehensive createPRNode and processCreatePRResult tests

## 2026-02-02 - Refactor: Remove isGraphEngineEnabled() Feature Flag

### Completed
- Removed isGraphEngineEnabled() function from src/config/ralph.ts
- Removed RALPH_ENV_VARS.ATOMIC_USE_GRAPH_ENGINE constant
- Removed useGraphEngine field from RalphConfig interface
- Removed useGraphEngine option from LoadRalphConfigOptions interface
- Updated loadRalphConfig() to no longer include useGraphEngine
- Updated describeRalphConfig() to no longer reference execution mode
- Updated RALPH_DEFAULTS to remove useGraphEngine (was false)
- Updated src/config/index.ts to remove isGraphEngineEnabled export
- Updated src/commands/ralph.ts:
  - Removed import of isGraphEngineEnabled
  - Simplified ralphSetup() to always use executeGraphWorkflow() (graph engine is now the only mode)
- Updated tests/config/ralph.test.ts:
  - Removed isGraphEngineEnabled test suite (7 tests)
  - Updated RALPH_ENV_VARS test to verify empty object
  - Updated RALPH_DEFAULTS tests to remove useGraphEngine
  - Updated loadRalphConfig tests to remove useGraphEngine references
  - Updated describeRalphConfig tests to remove execution mode references
  - Updated type tests to remove useGraphEngine
  - Updated integration tests to remove isGraphEngineEnabled references

### Rationale
- Graph engine is now the only execution mode
- Hook-based execution was legacy and no longer needed
- Simplifies the codebase by removing conditional execution paths
- Part of the transition to SDK-native workflow execution

### Test Results
- All 34 ralph config tests pass
- 53 expect() calls

### Files Modified
- src/config/ralph.ts - Removed isGraphEngineEnabled(), ATOMIC_USE_GRAPH_ENGINE, useGraphEngine
- src/config/index.ts - Removed isGraphEngineEnabled export
- src/commands/ralph.ts - Removed import and simplified ralphSetup()
- tests/config/ralph.test.ts - Updated tests to remove feature flag references

## 2026-02-02 - Feature Implementation: RALPH_CONFIG Constant

### Completed
- Added RalphWorkflowConfig interface in src/config/ralph.ts
  - maxIterations: number (default 100)
  - checkpointing: boolean (default true)
- Added RALPH_CONFIG constant with default configuration
  - maxIterations: 100 - Provides reasonable limit to prevent infinite loops
  - checkpointing: true - Enables workflow resumption after interruption
  - Note: autoApproveSpec intentionally not included - spec approval is manual
- Updated src/config/index.ts to export RalphWorkflowConfig and RALPH_CONFIG

### Tests Added
- RALPH_CONFIG tests:
  - maxIterations defaults to 100
  - checkpointing defaults to true
  - does not include autoApproveSpec (spec approval is manual)
  - has only maxIterations and checkpointing properties
- RalphWorkflowConfig type tests:
  - is properly typed
  - RALPH_CONFIG conforms to RalphWorkflowConfig

### Test Results
- All 40 ralph config tests pass (34 original + 6 new)
- 61 expect() calls

### Files Modified
- src/config/ralph.ts - Added RalphWorkflowConfig interface and RALPH_CONFIG constant
- src/config/index.ts - Added RalphWorkflowConfig and RALPH_CONFIG exports
- tests/config/ralph.test.ts - Added RALPH_CONFIG and RalphWorkflowConfig tests

## 2026-02-02 - Feature Implementation: createRalphWorkflow() function

### Completed
- Created src/workflows/ralph.ts with:
  - RALPH_NODE_IDS constant with 5 node IDs
  - CreateRalphWorkflowConfig interface for workflow configuration
  - createRalphWorkflow() function that builds the workflow graph
  - createTestRalphWorkflow() function for testing with minimal config
  - Re-export of RalphWorkflowState type

### Workflow Structure
The Ralph workflow follows this sequence:
1. init-session: Initialize or resume Ralph session
2. clear-context: Clear context window before loop
3. Loop: implement-feature (until shouldContinue is false)
4. check-completion: Final check after loop exits
5. create-pr: Create pull request with session metadata

### Configuration Options
- maxIterations: Maximum loop iterations (default: 100 from RALPH_CONFIG)
- checkpointing: Enable workflow resumption (default: true from RALPH_CONFIG)
- checkpointDir: Checkpoint storage directory
- featureListPath: Path to feature-list.json
- yolo: Enable yolo mode (no feature list)
- userPrompt: User prompt for yolo mode

### Updated Exports
- src/workflows/index.ts now exports:
  - createRalphWorkflow
  - createTestRalphWorkflow
  - RALPH_NODE_IDS
  - CreateRalphWorkflowConfig
  - RalphWorkflowState

### Tests Added (36 tests)
- RALPH_NODE_IDS constant tests
- createRalphWorkflow tests (various configs)
- createTestRalphWorkflow tests
- CreateRalphWorkflowConfig type tests
- Integration tests (node presence, workflow structure)

### Test Results
- All 140 workflow tests pass (104 original + 36 new)
- 322 expect() calls

### Files Modified
- src/workflows/ralph.ts - Created with createRalphWorkflow() function
- src/workflows/index.ts - Added Ralph workflow exports
- tests/workflows/ralph.test.ts - Created with 36 tests

## 2026-02-02 - Feature Implementation: clearContextNode Placement at Start of Loop Iterations

### Completed
- Extended GraphBuilder.loop() to accept array of nodes for multi-node loop bodies
  - loop() now accepts `NodeDefinition<TState> | NodeDefinition<TState>[]`
  - Body nodes are chained together in sequence within each iteration
  - Loop continue edge points to first body node (ensures ALL body nodes run each iteration)
  - Added validation for empty body array (throws error)

- Updated createRalphWorkflow() to place clearContextNode inside the loop
  - Previous structure: init -> clear -> loop(implement) -> check -> pr
  - New structure: init -> loop(clear, implement) -> check -> pr
  - clearContextNode now runs at START of EACH iteration, not just before the loop
  - This prevents context window overflow across multiple iterations
  - Each iteration starts with fresh context while preserving state

### Benefits of New Structure
1. **Prevent context window overflow**: Context cleared at each iteration start
2. **Fresh context per iteration**: Each iteration begins with clean slate
3. **Reduced token costs**: No accumulating conversation history
4. **State preservation**: Workflow state survives context clearing

### Tests Added
- GraphBuilder loop() with array tests (6 tests):
  - creates loop with array of body nodes
  - chains body nodes together in sequence
  - loop continue edge points to first body node
  - last body node connects to loop_check
  - throws error for empty body array
  - single node array works same as single node

- Ralph workflow clearContextNode placement tests (6 tests):
  - clearContextNode is inside the loop, not before it
  - clearContextNode chains to implementFeatureNode
  - implementFeatureNode connects to loop_check
  - loop continue edge points to clearContextNode (first in loop body)
  - loop structure: start -> clear -> implement -> check
  - init node does NOT connect directly to clearContextNode

### Test Results
- All 52 builder tests pass (46 original + 6 new)
- All 42 ralph workflow tests pass (36 original + 6 new)
- All 620 graph/workflow tests pass

### Files Modified
- src/graph/builder.ts - Extended loop() to accept array of nodes
- src/workflows/ralph.ts - Updated to place clearContextNode inside loop
- tests/graph/builder.test.ts - Added loop array tests
- tests/workflows/ralph.test.ts - Added clearContextNode placement tests

## 2026-02-02 - Feature Implementation: RalphExecutor Class

### Completed
- Created src/workflows/ralph-executor.ts with RalphExecutor class
  - Manages workflow execution lifecycle with interrupt handling
  - Private fields: abortController, sessionDir, sessionId, sigintHandler, stdinHandler
  - Constructor initializes AbortController

- Implemented setupInterruptHandlers() method
  - SIGINT handler (Ctrl+C): Calls handleInterrupt() on signal
  - Esc key handler (TTY mode only): Checks for 0x1b keycode
  - Sets raw mode on stdin for key detection
  - Tracks handler setup state for cleanup

- Implemented handleInterrupt() method
  - Logs "Stopping Ralph execution..."
  - Signals abort via abortController.abort()
  - Loads session state if sessionDir exists
  - Sets session.status to "paused"
  - Updates session.lastUpdated timestamp
  - Saves session state to disk
  - Logs resume instructions with session ID
  - Calls cleanup() and process.exit(0)

- Implemented run() method
  - Resets AbortController for each run
  - Sets up interrupt handlers
  - Returns RalphExecutorResult with state, completed, interrupted, error fields
  - Handles execution errors gracefully

- Implemented cleanup() method
  - Removes SIGINT handler from process
  - Removes stdin data handler
  - Restores TTY mode (setRawMode false)
  - Idempotent (safe to call multiple times)

- Implemented helper methods
  - signal getter: Returns AbortSignal
  - aborted getter: Returns whether execution was aborted
  - setSession(): Sets session ID and directory for interrupt handling

- Created factory function
  - createRalphExecutor(): Creates new RalphExecutor instance

- Exported types
  - RalphExecutorRunOptions: Options for run() method
  - RalphExecutorResult: Result of workflow execution

### Tests Added (20 tests)
- RalphExecutor constructor tests
- signal and aborted property tests
- setSession() tests
- cleanup() idempotency tests
- run() method tests (returns result, accepts initial state, resets abort controller)
- createRalphExecutor() factory tests
- Type tests for RalphExecutorRunOptions and RalphExecutorResult
- Integration tests (executor with workflow, yolo mode, multiple executors)

### Test Results
- All 20 ralph-executor tests pass
- All 166 workflow tests pass

### Files Created
- src/workflows/ralph-executor.ts - RalphExecutor class
- tests/workflows/ralph-executor.test.ts - RalphExecutor tests

### Files Modified
- src/workflows/index.ts - Added RalphExecutor exports
- research/feature-list.json - Marked 5 related features as passes: true

## 2026-02-02 - Feature Implementation: Add /ralph Command to BUILTIN_WORKFLOW_DEFINITIONS

### Completed
- Added /ralph as a standalone workflow command in BUILTIN_WORKFLOW_DEFINITIONS
  - Name: "ralph"
  - Description: "Start the Ralph autonomous implementation workflow"
  - Uses createRalphWorkflow() function (separate from atomic workflow)
  - Supports configuration: maxIterations, checkpointing, featureListPath, yolo, userPrompt
  - No aliases (only accessible via /ralph)

- Updated atomic workflow
  - Removed "ralph" from aliases (ralph is now separate)
  - Kept "loop" as alias for atomic
  - Updated description to clarify it includes research/spec phases

- Made WorkflowMetadata generic
  - Interface now supports different state types: WorkflowMetadata<TState extends BaseState>
  - Allows type-safe workflow definitions for different workflow states

### Tests Updated
- Updated WORKFLOW_DEFINITIONS tests for ralph being separate workflow
- Added tests for ralph workflow definition
- Added tests for ralph command metadata
- Updated alias tests to reflect ralph is no longer an alias
- Updated getWorkflowMetadata tests for ralph as separate workflow

### Test Results
- All 32 workflow-commands tests pass

### Files Modified
- src/ui/commands/workflow-commands.ts - Added ralph to BUILTIN_WORKFLOW_DEFINITIONS
- tests/ui/commands/workflow-commands.test.ts - Updated tests for ralph separation
- research/feature-list.json - Marked feature as passes: true

## 2026-02-02 - Feature Implementation: Implement --yolo flag parsing for /ralph command

### Completed
- Added parseRalphArgs() function in workflow-commands.ts
  - Parses --yolo flag from command args string
  - Returns RalphCommandArgs interface: { yolo: boolean, prompt: string | null }
  - --yolo flag must be at start of args (e.g., "--yolo implement auth")
  - If --yolo in middle of args, treated as part of prompt (normal mode)

- Added RalphCommandArgs interface
  - yolo: boolean - Whether --yolo flag is present
  - prompt: string | null - User prompt (required for --yolo mode)

- Created specialized createRalphCommand() function
  - Handles ralph-specific flag parsing
  - Validates --yolo requires a prompt
  - Passes yolo and userPrompt to workflow config via ralphConfig state
  - Shows "(yolo mode)" in success messages when --yolo is used

- Added ralphConfig to CommandContextState interface
  - New optional field: ralphConfig?: { yolo: boolean; userPrompt: string }
  - Stores ralph-specific configuration for workflow execution

### Tests Added
- parseRalphArgs tests (8 tests):
  - parses --yolo flag with prompt
  - parses --yolo flag without prompt
  - parses --yolo with leading/trailing whitespace
  - parses normal mode with prompt
  - parses empty args as normal mode with null prompt
  - parses whitespace-only args as null prompt
  - does not treat --yolo in the middle as a flag
  - handles multiline prompts after --yolo

- ralph command --yolo flag tests (5 tests):
  - ralph command with --yolo flag and prompt succeeds
  - ralph command with --yolo flag without prompt fails
  - ralph command without flags requires prompt
  - ralph command without flags uses normal mode
  - ralph command adds system message with yolo indicator

### Test Results
- All 45 workflow-commands tests pass

### Files Modified
- src/ui/commands/workflow-commands.ts - Added parseRalphArgs(), createRalphCommand(), RalphCommandArgs
- src/ui/commands/registry.ts - Added ralphConfig to CommandContextState
- tests/ui/commands/workflow-commands.test.ts - Added parseRalphArgs and --yolo flag tests
- research/feature-list.json - Marked feature 52 as passes: true

## 2026-02-02 - Feature Implementation: --resume Flag for /ralph Command

### Completed
- Added resumeSessionId field to RalphCommandArgs interface
- Updated parseRalphArgs() to parse --resume <uuid> flag
  - Extracts first token after --resume as session ID
  - Returns null if no UUID provided
- Added isValidUUID() helper function for UUID v4 format validation
- Updated createRalphCommand() to handle --resume flag:
  - Validates UUID format (returns error for invalid format)
  - Checks if session exists at .ralph/sessions/{uuid}/
  - Returns 'Session not found' error if directory doesn't exist
  - Passes resumeSessionId to workflow config
  - Logs 'Resuming session: {uuid}' via system message
- Added import for getSessionDir from workflows/ralph-session.ts

### Tests Added
- isValidUUID tests:
  - validates correct UUID v4 format
  - is case-insensitive
  - rejects invalid formats
- parseRalphArgs --resume flag tests:
  - parses --resume flag with UUID
  - parses --resume flag without UUID
  - parses --resume with leading/trailing whitespace
  - extracts only first token after --resume
  - does not treat --resume in the middle as a flag
  - --resume takes precedence over --yolo when first
- ralph command --resume integration tests:
  - ralph command with --resume flag and valid session succeeds
  - ralph command with --resume flag and invalid UUID fails
  - ralph command with --resume flag and non-existent session fails
  - ralph command with --resume flag without UUID fails
  - ralph command adds system message when resuming
  - ralph command with --resume sets correct workflow state

### Test Results
- All workflow-commands tests pass (60 tests)

### Files Modified
- src/ui/commands/workflow-commands.ts - Added --resume flag support
- tests/ui/commands/workflow-commands.test.ts - Added --resume flag tests

## 2026-02-03 - Feature Implementation: --max-iterations Flag for /ralph Command

### Completed
- Added maxIterations field to RalphCommandArgs interface
- Added DEFAULT_MAX_ITERATIONS constant (100)
- Updated parseRalphArgs() to parse --max-iterations <number> flag
  - Extracts numeric value after --max-iterations
  - Validates it's a non-negative integer via regex
  - Can be combined with --yolo or --resume flags
  - Flag position is flexible (can be before or after other flags)
  - Defaults to 100 if not specified
  - 0 means infinite iterations
- Updated ralphConfig in registry.ts to include maxIterations field
- Updated createRalphCommand() to pass maxIterations to state
  - Sets both stateUpdate.maxIterations and ralphConfig.maxIterations
  - Shows "(max: N)" in messages when non-default value is used

### Tests Added
- parseRalphArgs --max-iterations tests (9 tests):
  - parses --max-iterations flag with number
  - defaults to 100 if --max-iterations not specified
  - parses --max-iterations 0 for infinite iterations
  - parses --max-iterations with --yolo flag (--max-iterations first)
  - parses --max-iterations with --yolo flag (--yolo first)
  - parses --max-iterations with leading/trailing whitespace
  - --max-iterations with --resume flag
  - does not treat --max-iterations in the middle of prompt as a flag
  - handles large iteration numbers

- ralph command --max-iterations integration tests (6 tests):
  - ralph command with --max-iterations sets correct state
  - ralph command with --max-iterations 0 sets infinite iterations
  - ralph command defaults maxIterations to 100
  - ralph command with --max-iterations and --yolo shows both in message
  - ralph command system message includes max-iterations when non-default
  - ralph command system message does not include max-iterations when default

### Test Results
- All 75 workflow-commands tests pass

### Files Modified
- src/ui/commands/workflow-commands.ts - Added --max-iterations flag support
- src/ui/commands/registry.ts - Added maxIterations to ralphConfig interface
- tests/ui/commands/workflow-commands.test.ts - Added --max-iterations flag tests
- research/feature-list.json - Marked feature as passes: true

## 2026-02-03 - Feature Implementation: --feature-list Flag for /ralph Command

### Completed
- Added `featureListPath` field to `RalphCommandArgs` interface
- Updated `parseRalphArgs()` to parse `--feature-list <path>` flag
  - Defaults to "research/feature-list.json" when not specified
  - Correctly handles flag positioning (only matches at start or after other flags)
  - Works in combination with `--yolo`, `--max-iterations`, and `--resume` flags
- Updated `createRalphCommand()` to validate feature list file exists
  - Shows error if file not found and not in `--yolo` mode
  - Skips validation in `--yolo` mode (yolo doesn't need feature list)
- Added `featureListPath` to `ralphConfig` state update
- Non-default feature list path shown in workflow start message

### Tests Added (17 new tests)
- parseRalphArgs --feature-list flag tests:
  - parses --feature-list flag with path
  - defaults to research/feature-list.json if not specified
  - parses --feature-list with full path
  - parses --feature-list with --yolo flag (--feature-list first)
  - parses --feature-list with --yolo flag (--yolo first)
  - parses --feature-list with leading/trailing whitespace
  - --feature-list with --resume flag
  - --feature-list with --max-iterations flag
  - does not treat --feature-list in the middle of prompt as a flag
  - parses relative path with directory

- ralph command --feature-list integration tests:
  - ralph command with --feature-list and existing file succeeds
  - ralph command with --feature-list and non-existent file fails
  - ralph command with --yolo skips feature list validation
  - ralph command defaults featureListPath to research/feature-list.json
  - ralph command with custom --feature-list shows in message
  - ralph command with non-default --feature-list shows in message
  - ralph command system message includes feature-list when non-default
  - ralph command system message does not include feature-list when default

### Test Results
- All workflow-commands tests pass (93 tests)

### Files Modified
- src/ui/commands/workflow-commands.ts - Added --feature-list flag parsing
- tests/ui/commands/workflow-commands.test.ts - Added --feature-list tests

## 2026-02-03 - Refactor: Remove /atomic Command Registration

### Completed
- Removed `/atomic` command registration from `BUILTIN_WORKFLOW_DEFINITIONS`
- Removed unused `createAtomicWorkflow` and `AtomicWorkflowConfig` imports from workflow-commands.ts
- Transferred the `loop` alias from `/atomic` to `/ralph` (ralph now has aliases: ["loop"])
- Updated docstring example in index.ts to reference `/ralph` instead of `/atomic`
- Updated all tests in workflow-commands.test.ts to test `/ralph` instead of `/atomic`

### Notes
- The `createAtomicWorkflow` function and `atomic.ts` workflow file are still used by:
  - src/commands/ralph.ts
  - src/commands/chat.ts
- Only the command registration was removed, not the underlying workflow implementation
- The `/loop` alias now points to `/ralph` instead of `/atomic`

### Test Results
- All 82 workflow-commands tests pass

### Files Modified
- src/ui/commands/workflow-commands.ts - Removed atomic command, transferred loop alias to ralph
- src/ui/commands/index.ts - Updated docstring example
- tests/ui/commands/workflow-commands.test.ts - Updated tests to reference ralph
- research/feature-list.json - Marked feature as passes: true

## 2026-02-03 - Feature Implementation: Remove /ralph:ralph-loop Command Registration

### Completed
- Removed `ralph:ralph-loop` from `SKILL_DEFINITIONS` in skill-commands.ts
- Replaced `/ralph:ralph-loop` with `/ralph` in telemetry constants:
  - src/utils/telemetry/constants.ts - ATOMIC_COMMANDS
  - src/sdk/opencode-hooks.ts - ATOMIC_COMMANDS
  - src/sdk/copilot-hooks.ts - ATOMIC_COMMANDS
- Updated tests to reflect the removal:
  - tests/ui/commands/skill-commands.test.ts - Updated ralph skill tests
  - tests/ui/commands/index.test.ts - Updated command registration tests
  - tests/telemetry/telemetry-cli.test.ts - Updated namespaced command tests
  - tests/telemetry/telemetry-session.test.ts - Updated ralph command extraction tests
  - tests/sdk/opencode-hooks.test.ts - Updated ATOMIC_COMMANDS list
  - tests/sdk/copilot-hooks.test.ts - Updated ralph command test

### Notes
- The `/ralph:ralph-loop` command is now replaced by the SDK-native `/ralph` workflow
- Other ralph skills (`ralph:cancel-ralph`, `ralph:ralph-help`) remain unchanged
- The `ralph-loop.local.md` state file naming convention is preserved (used internally)

### Test Results
- All affected tests pass (skill-commands, index, telemetry-cli, telemetry-session, opencode-hooks, copilot-hooks)
- Pre-existing test failures in builtin-commands.test.ts (expects 6 commands, but there are 7 due to compactCommand) - not related to this feature

### Files Modified
- src/ui/commands/skill-commands.ts - Removed ralph:ralph-loop skill definition
- src/utils/telemetry/constants.ts - Replaced /ralph:ralph-loop with /ralph
- src/sdk/opencode-hooks.ts - Replaced /ralph:ralph-loop with /ralph
- src/sdk/copilot-hooks.ts - Replaced /ralph:ralph-loop with /ralph
- tests/ui/commands/skill-commands.test.ts - Updated tests
- tests/ui/commands/index.test.ts - Updated tests
- tests/telemetry/telemetry-cli.test.ts - Updated tests
- tests/telemetry/telemetry-session.test.ts - Updated tests
- tests/sdk/opencode-hooks.test.ts - Updated tests
- tests/sdk/copilot-hooks.test.ts - Updated tests
- research/feature-list.json - Marked feature as passes: true

## 2026-02-02 - Feature Implementation: Remove /ralph:cancel-ralph Command Registration

### Completed
- Removed `/ralph:cancel-ralph` command registration from `.opencode/opencode.json`
- Updated `ralph:ralph-help` template to replace `/cancel-ralph` references with Ctrl+C/Esc
- Updated `ralph:ralph-loop` template to replace cancellation instructions with Ctrl+C/Esc
- Removed the `/cancel-ralph` documentation section from help text
- Updated `getRalphSkills` test expectation from >=2 to >=1 (only ralph:ralph-help remains)

### Rationale
The `/ralph:cancel-ralph` command is no longer needed - users should use Ctrl+C or Esc instead for manual cancellation. This is part of the SDK-native workflow migration where ralph:ralph-loop and ralph:cancel-ralph are replaced by the SDK-native /ralph workflow.

### Test Results
- All skill-commands tests pass (108 tests)

### Files Modified
- .opencode/opencode.json - Removed ralph:cancel-ralph command, updated help templates
- tests/ui/commands/skill-commands.test.ts - Updated getRalphSkills test expectation

---

## 2026-02-03 - Refactor: Remove /status Command Registration

### Completed
- Removed /status command from builtin-commands.ts
  - Removed statusCommand export and definition
  - Removed from builtinCommands array (now 4 commands: help, theme, clear, compact)
  - Removed formatNodeName() and createProgressBar() helper functions
  - Updated file header comment
- Updated index.ts
  - Removed statusCommand from exports
  - Updated comment: "Built-in commands (help, theme, clear, compact)"
- Updated cli.ts
  - Removed /status from slash commands help text
- Updated chat.ts
  - Removed /status command handler block in wrapSessionWithWorkflow()
  - Updated /help output to remove /status reference
  - Updated "Starting workflow execution..." message to not reference /status
- Updated workflow-commands.ts
  - Changed "Use /status to check progress" to "Check research/progress.txt for progress" (2 occurrences)

### Tests Updated
- tests/ui/commands/builtin-commands.test.ts
  - Removed statusCommand import
  - Removed entire statusCommand test suite (17 tests removed)
  - Updated builtinCommands array test (4 commands instead of 5)
  - Updated "contains all built-in commands" test to not include statusCommand
  - Updated "registers all built-in commands" test to verify status is NOT registered
  - Updated "registers aliases" test to verify "s" alias is NOT registered
  - Updated idempotent test (size 4 instead of 5)
- tests/ui/commands/index.test.ts
  - Updated expect for globalRegistry.has("status") to be false
  - Updated expect for globalRegistry.has("s") to be false
- tests/ui/index.test.ts
  - Updated "initializeCommands is exported and callable" test to expect status=false
  - Updated "globalRegistry is properly populated" test to expect status and "s" alias undefined
  - Updated reference from /atomic to /ralph workflow

### Test Results
- All UI commands tests pass (475 tests)
- All builtin-commands tests pass (20 tests)
- All index tests pass (31 tests, commands/index.test.ts)
- UI index tests pass (24 tests, ui/index.test.ts)

### Files Modified
- src/ui/commands/builtin-commands.ts - Removed /status command
- src/ui/commands/index.ts - Removed statusCommand export
- src/cli.ts - Removed /status from help text
- src/commands/chat.ts - Removed /status handling
- src/ui/commands/workflow-commands.ts - Updated messages to reference progress.txt
- tests/ui/commands/builtin-commands.test.ts - Removed statusCommand tests
- tests/ui/commands/index.test.ts - Updated status registration tests
- tests/ui/index.test.ts - Updated status registration tests

### Rationale
Progress tracking is now done via research/progress.txt instead of the /status command.
This simplifies the command system and encourages the use of file-based progress tracking
that persists across sessions and can be reviewed externally.

---

## 2026-02-03 - Feature Verification: CommandCategory and CommandContext interfaces in registry.ts

### Status: COMPLETED - Verified and Extended

#### CommandCategory Type
The CommandCategory type was already properly defined in src/ui/commands/registry.ts at line 102.

**Implementation Details:**
- **Location**: src/ui/commands/registry.ts (line 102)
- **Type Definition**: `type CommandCategory = "builtin" | "workflow" | "skill" | "agent" | "custom"`
- Categories include:
  - `builtin` - For /help, /clear commands
  - `skill` - For /commit, /research commands
  - `workflow` - For /ralph command
  - `agent` - For sub-agent commands
  - `custom` - For user-defined commands

**Tests Added (7 new tests):**
- includes 'builtin' for help, clear commands
- includes 'skill' for commit, research commands
- includes 'workflow' for ralph command
- includes 'agent' for sub-agent commands
- includes 'custom' for user-defined commands
- all categories can be used in CommandDefinition
- registry sorting uses all category priorities

#### CommandContext Interface
The CommandContext interface was extended to include the `spawnSubagent` method.

**Implementation Details:**
- **Location**: src/ui/commands/registry.ts (lines 48-72)
- **Fields Added**:
  - `spawnSubagent: (options: SpawnSubagentOptions) => Promise<SpawnSubagentResult>`
- **Supporting Types Added**:
  - `SpawnSubagentOptions` interface with systemPrompt, message, tools?, model?
  - `SpawnSubagentResult` interface with success, output, error?

**Tests Added (12 new tests for CommandContext, SpawnSubagentOptions, SpawnSubagentResult):**
- CommandContext has session field that can be Session or null
- CommandContext has state field of type CommandContextState
- CommandContext has addMessage method with role and content parameters
- CommandContext has setStreaming method with streaming parameter
- CommandContext has sendMessage method with content parameter
- CommandContext has spawnSubagent method that returns Promise<SpawnSubagentResult>
- SpawnSubagentOptions requires systemPrompt and message fields
- SpawnSubagentOptions supports optional tools array
- SpawnSubagentOptions supports optional model field
- SpawnSubagentOptions model can be sonnet, opus, or haiku
- SpawnSubagentResult has success and output fields
- SpawnSubagentResult supports optional error field when failed

#### CommandResult Interface
The CommandResult interface was already properly defined in src/ui/commands/registry.ts.

**Implementation Details:**
- **Location**: src/ui/commands/registry.ts (lines 124-135)
- **Interface Fields**:
  - `success: boolean`
  - `message?: string`
  - `stateUpdate?: Partial<CommandContextState>`
  - `clearMessages?: boolean`

#### Test Results
- All 54 tests in tests/ui/commands/registry.test.ts pass
- Total expect() calls: 103
- All 532 tests in tests/ui/commands/ pass

#### Files Modified
- src/ui/commands/registry.ts - Added SpawnSubagentOptions, SpawnSubagentResult interfaces, added spawnSubagent to CommandContext
- src/ui/chat.tsx - Added spawnSubagent implementation in context
- tests/ui/commands/registry.test.ts - Added 19 new tests for CommandCategory, CommandContext, SpawnSubagentOptions, SpawnSubagentResult
- tests/ui/commands/skill-commands.test.ts - Updated mock context with spawnSubagent
- tests/ui/commands/builtin-commands.test.ts - Updated mock context with sendMessage and spawnSubagent
- tests/ui/commands/workflow-commands.test.ts - Updated mock context with sendMessage and spawnSubagent
- tests/ui/chat-command-execution.test.ts - Updated mock context with spawnSubagent

---

## 2026-02-03 - Feature Verification: Define WorkflowMetadata interface in workflow-commands.ts

### Status: VERIFIED - Already Implemented with Enhanced Tests

The WorkflowMetadata interface was already properly defined in src/ui/commands/workflow-commands.ts. Added comprehensive tests to verify all interface fields.

#### Implementation Details
- **Location**: src/ui/commands/workflow-commands.ts (lines 210-223)
- **Interface Fields**:
  - `name: string` - Command name (without leading slash)
  - `description: string` - Human-readable description
  - `aliases?: string[]` - Alternative names for the command
  - `createWorkflow: (config?) => CompiledGraph<TState>` - Function to create the workflow graph
  - `defaultConfig?: Record<string, unknown>` - Optional default configuration
  - `source?: 'builtin' | 'global' | 'local'` - Source type (built-in, global, or local)

#### Tests Added
- `each definition has valid defaultConfig if present` - Verifies defaultConfig is object type when present
- `each definition has valid source if present` - Verifies source is one of 'builtin', 'global', 'local'
- `built-in workflows have source 'builtin'` - Verifies all WORKFLOW_DEFINITIONS have source 'builtin'
- `createWorkflow returns a compiled graph` - Verifies CompiledGraph structure (nodes, edges, startNode, endNodes, config)
- `createWorkflow accepts optional config parameter` - Verifies config parameter handling

#### Test Results
- All 127 tests in tests/ui/commands/workflow-commands.test.ts pass
- Total expect() calls: 310

#### Files Modified
- tests/ui/commands/workflow-commands.test.ts - Added 5 new tests for WorkflowMetadata interface validation

