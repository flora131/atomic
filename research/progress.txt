## 2026-01-23: Clean Data Directory on Update - Feature 1 Complete

### Feature: Add rm() call to remove data directory before extractConfig() in TypeScript update command

**Changes made:**
1. `src/commands/update.ts:248` - Added `await rm(dataDir, { recursive: true, force: true })` before `extractConfig()` call in `updateCommand()`
2. `src/commands/update.ts:116` - Exported `extractConfig` function to enable testing
3. `tests/update.test.ts` - Added 4 new tests in "clean data directory on update" describe block:
   - `rm before extractConfig removes stale files from data directory`
   - `extractConfig without rm leaves stale files in place`
   - `rm on non-existent directory does not throw`
   - `extractConfig recreates directory after rm`

**Test results:** All 343 tests pass (20 in update.test.ts: 16 existing + 4 new)

**Next feature:** Add rm -rf and mkdir -p to install.sh before tar extraction

## 2026-01-23: Clean Data Directory on Update - Feature 2 Complete

### Feature: Add rm -rf and mkdir -p to install.sh before tar extraction

**Changes made:**
1. `install.sh:201-205` - Updated extraction section to:
   - Changed comment to "clean install"
   - Added `rm -rf "$DATA_DIR"` before tar extraction
   - Added `mkdir -p "$DATA_DIR"` after rm and before tar
2. `tests/install-sh-clean-dir.test.ts` - Created new test file with 5 tests:
   - `rm -rf and mkdir -p before tar removes stale files`
   - `tar without rm leaves stale files in place`
   - `rm -rf on non-existent directory succeeds`
   - `mkdir -p recreates directory after rm -rf`
   - `install.sh contains the rm -rf and mkdir -p commands before tar`

**Test results:** All 348 tests pass (5 in install-sh-clean-dir.test.ts)

**Next feature:** Add Remove-Item and New-Item to install.ps1 before Expand-Archive

## 2026-01-23: Clean Data Directory on Update - Feature 3 Complete

### Feature: Add Remove-Item and New-Item to install.ps1 before Expand-Archive

**Changes made:**
1. `install.ps1:139-143` - Updated extraction section to:
   - Changed comment to "clean install"
   - Added `if (Test-Path $DataDir) { Remove-Item -Recurse -Force $DataDir }` before Expand-Archive
   - Added `$null = New-Item -ItemType Directory -Force -Path $DataDir` after Remove-Item
2. `tests/install-ps1-clean-dir.test.ts` - Created new test file with 4 tests:
   - `install.ps1 contains Remove-Item before Expand-Archive`
   - `install.ps1 guards Remove-Item with Test-Path check`
   - `install.ps1 uses $null assignment for New-Item to suppress output`
   - `install.ps1 comment indicates clean install behavior`

**Test results:** All 352 tests pass (4 in install-ps1-clean-dir.test.ts)

**Next feature:** Verify no stale artifacts remain after update or re-install across all three code paths

## 2026-01-23: Clean Data Directory on Update - Feature 4 Complete (ALL FEATURES DONE)

### Feature: Verify no stale artifacts remain after update or re-install across all three code paths

**Changes made:**
1. `tests/clean-install-verification.test.ts` - Created comprehensive cross-path verification test with 8 tests:
   - TypeScript path: stale files from previous version are removed after rm + extractConfig
   - TypeScript path: deeply nested stale files are removed
   - install.sh path: stale files are removed by rm -rf + mkdir -p + tar sequence
   - install.sh path: hidden files (dotfiles) in stale directory are removed
   - install.ps1 path: stale files are removed by simulated Remove-Item + New-Item + extract
   - install.ps1 path: first install works when directory does not exist (Test-Path guard)
   - Consistency: all paths produce identical directory contents after clean install
   - Source code: all three code paths contain the clean install pattern

**Test results:** All 360 tests pass across 22 files

**All features in research/feature-list.json are now complete (passes: true)**
